é¸¿è’™ AI æ™ºèƒ½æ•°æ®å¯è§†åŒ–åŠ©æ‰‹ï¼ˆSupabaseäº‘ç«¯æ”¯æŒç‰ˆï¼‰é¡¹ç›®è®¡åˆ’ä¹¦
ä¸€ã€é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€æ¬¾åŸºäº HarmonyOSï¼ˆé¸¿è’™ç³»ç»Ÿï¼‰ çš„æ™ºèƒ½æ•°æ®å¯è§†åŒ–åº”ç”¨ï¼Œç»“åˆ Supabase ä½œä¸ºè½»åç«¯äº‘å¹³å°ï¼Œå®ç°ç”¨æˆ·æ•°æ®çš„ AI åˆ†æä¸å›¾è¡¨è‡ªåŠ¨ç”Ÿæˆã€‚åŒæ—¶ï¼Œåº”ç”¨è¿˜é›†æˆäº† Pomodoroï¼ˆç•ªèŒ„é’Ÿï¼‰ä¸“æ³¨ç®¡ç†åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·æå‡å·¥ä½œæ•ˆç‡ã€‚

åº”ç”¨æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š

**æ•°æ®å¯è§†åŒ–æ¨¡å—**ï¼š
- å°†æ•°æ®ä¸Šä¼ åˆ° Supabaseï¼›
- æ”¯æŒä¸Šä¼  CSVã€JSONã€Excel æ–‡ä»¶æˆ–æ‰‹åŠ¨è¾“å…¥æ•°æ®ï¼›
- æä¾›æ ·æœ¬æ•°æ®ä¸€é”®åŠ è½½åŠŸèƒ½ï¼Œå¿«é€Ÿä½“éªŒå›¾è¡¨ç”Ÿæˆï¼›
- ç”±äº‘ç«¯ AI æ¨¡å‹åˆ†æç”Ÿæˆ ECharts å›¾è¡¨é…ç½®ï¼›
- é¸¿è’™ç«¯æ‹‰å–å›¾è¡¨ç»“æœè¿›è¡Œæ¸²æŸ“ï¼›
- æ”¯æŒå›¾è¡¨é‡æ–°ç”Ÿæˆå’Œç±»å‹åˆ‡æ¢ï¼›
- æä¾› AI æ´å¯ŸåŠŸèƒ½ï¼Œæ™ºèƒ½åˆ†æå›¾è¡¨æ•°æ®å¹¶ç»™å‡ºå»ºè®®ï¼›
- æ”¯æŒå¯¼å‡ºå›¾è¡¨ï¼ˆPNG / PDF / JSONï¼‰ã€‚

**ä¸“æ³¨ç®¡ç†æ¨¡å—**ï¼š
- Pomodoro è®¡æ—¶å™¨ï¼ˆ25åˆ†é’Ÿä¸“æ³¨æ—¶é—´ï¼‰ï¼›
- ä»»åŠ¡ç®¡ç†ä¸è¿›åº¦è¿½è¸ªï¼›
- ä¸“æ³¨æ—¶é—´ç»Ÿè®¡ä¸åˆ†æï¼›
- AI æ´å¯ŸåŠŸèƒ½ï¼ŒåŸºäºä¸“æ³¨æ•°æ®ç”Ÿæˆæ™ºèƒ½åˆ†ææŠ¥å‘Šå’Œå»ºè®®ï¼›
- å¤šè®¾å¤‡é€‚é…æ”¯æŒã€‚

è¯¥æ¶æ„æ—¢ä¿æŒå‰ç«¯è½»é‡ã€çµæ´»ï¼Œåˆåˆ©ç”¨ Supabase æä¾›å®‰å…¨å­˜å‚¨ã€APIä»£ç†ã€èº«ä»½éªŒè¯ç­‰èƒ½åŠ›ï¼Œå®ç°çœŸæ­£çš„äº‘ç«¯æ™ºèƒ½å¯è§†åŒ–ä¸æœ¬åœ°ä¸“æ³¨ç®¡ç†ã€‚

äºŒã€é¡¹ç›®ç›®æ ‡
åŠŸèƒ½æ–¹å‘	ç›®æ ‡è¯´æ˜
æ•°æ®è¾“å…¥	æ”¯æŒç”¨æˆ·ä¸Šä¼  CSVã€JSONã€Excel æ–‡ä»¶æˆ–æ‰‹åŠ¨è¾“å…¥æ•°æ®
æ ·æœ¬æ•°æ®	æä¾›é¢„è®¾ç¤ºä¾‹æ•°æ®é›†ï¼Œç”¨æˆ·å¯ä¸€é”®åŠ è½½å¿«é€Ÿä½“éªŒ
äº‘ç«¯åŒæ­¥	æ‰€æœ‰æ•°æ®ä¸Šä¼ è‡³ Supabase å­˜å‚¨æˆ–æ•°æ®åº“
 AI åˆ†æ	äº‘ç«¯è°ƒç”¨ AIï¼ˆé€šä¹‰åƒé—® Qwenï¼‰ç”Ÿæˆå›¾è¡¨é…ç½®
å›¾è¡¨å±•ç¤º	é¸¿è’™ç«¯ä½¿ç”¨ ECharts æ¸²æŸ“ AI è¿”å›é…ç½®
å›¾è¡¨æ§åˆ¶	æ”¯æŒå›¾è¡¨é‡æ–°ç”Ÿæˆã€ç±»å‹åˆ‡æ¢ï¼ˆæŠ˜çº¿/æŸ±çŠ¶/é¥¼å›¾ç­‰ï¼‰
AI æ´å¯Ÿ	æä¾›å›¾è¡¨æ•°æ®å’Œä¸“æ³¨æ•°æ®çš„æ™ºèƒ½åˆ†ææŠ¥å‘Šå’Œå»ºè®®
å›¾è¡¨å¯¼å‡º	ç”¨æˆ·å¯å¯¼å‡ºå›¾è¡¨ï¼ˆPNGã€PDFã€JSONï¼‰
ç”¨æˆ·ç®¡ç†	Supabase æä¾›ç”¨æˆ·æ³¨å†Œ / ç™»å½• / æ•°æ®å…³è”
ä¸“æ³¨ç®¡ç†	Pomodoro è®¡æ—¶å™¨ã€ä»»åŠ¡ç®¡ç†ã€ä¸“æ³¨æ—¶é—´ç»Ÿè®¡
å¤šè®¾å¤‡é€‚é…	æ”¯æŒæ‰‹æœºã€å¹³æ¿ã€TVã€è½¦æœºã€å¯ç©¿æˆ´è®¾å¤‡ç­‰
å¯æ‰©å±•æ€§	åæœŸå¯æ‹“å±•åˆ†ææŠ¥å‘Šã€è¯­éŸ³è¾“å…¥ã€æ•°æ®é¢„æµ‹ç­‰åŠŸèƒ½
ä¸‰ã€ç³»ç»Ÿæ€»ä½“æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           é¸¿è’™App (DevEco ArkTS)           â”‚
â”‚--------------------------------------------â”‚
â”‚ - ç”¨æˆ·ä¸Šä¼ /è¾“å…¥æ•°æ®                        â”‚
â”‚ - ç™»å½•/æ³¨å†Œ(Supabase Auth)                 â”‚
â”‚ - æ˜¾ç¤ºAIç”Ÿæˆçš„å›¾è¡¨(ECharts)                â”‚
â”‚ - ä¸‹è½½å›¾è¡¨(PNG/PDF)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ HTTPS è¯·æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Supabase äº‘å¹³å°               â”‚
â”‚---------------------------------------------â”‚
â”‚ Authï¼šç”¨æˆ·ç®¡ç†                              â”‚
â”‚ Storageï¼šå­˜å‚¨ä¸Šä¼ æ–‡ä»¶ï¼ˆCSVã€å›¾ç‰‡ç­‰ï¼‰         â”‚
â”‚ Databaseï¼šè®°å½•å›¾è¡¨å…ƒæ•°æ®å’ŒAIç»“æœ             â”‚
â”‚ Edge Functionï¼šAIæ¥å£ä»£ç†(è°ƒç”¨Qwenå…¼å®¹API)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               AI æ¨¡å‹æœåŠ¡                   â”‚
â”‚  (é€šä¹‰åƒé—® / æ–‡å¿ƒä¸€è¨€ ç­‰)                  â”‚
â”‚ - æ¥æ”¶æ•°æ®å¹¶è¿”å›EChartsé…ç½®JSON             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å››ã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—è®¾è®¡

**æ•°æ®å¯è§†åŒ–æ¨¡å—**ï¼š
æ¨¡å—	åŠŸèƒ½è¯´æ˜	æŠ€æœ¯å®ç°
1ï¸âƒ£ æ•°æ®è¾“å…¥æ¨¡å—	ä¸Šä¼ CSV/JSONæ–‡ä»¶æˆ–æ–‡æœ¬è¾“å…¥	ArkTS FilePicker + TextArea
1ï¸âƒ£-1ï¸âƒ£ æ ·æœ¬æ•°æ®æ¨¡å—	æä¾›é¢„è®¾ç¤ºä¾‹æ•°æ®é›†ï¼Œä¸€é”®åŠ è½½	æœ¬åœ° JSON/CSV èµ„æºæ–‡ä»¶
1ï¸âƒ£-2ï¸âƒ£ æ‰‹åŠ¨è¾“å…¥æ¨¡å—	æ˜ç¡®çš„æ‰‹åŠ¨è¾“å…¥å…¥å£æŒ‰é’®	ä¼˜åŒ– TextArea è§†è§‰å‘ˆç°æˆ–æ·»åŠ æŒ‰é’®
2ï¸âƒ£ ç”¨æˆ·ç™»å½•æ¨¡å—	Supabase Auth ç”¨æˆ·ä½“ç³»	OAuth / é‚®ç®±æ³¨å†Œ
3ï¸âƒ£ äº‘ç«¯å­˜å‚¨æ¨¡å—	ä¸Šä¼ æ•°æ®æ–‡ä»¶è‡³ Supabase Storage	Supabase SDK
4ï¸âƒ£ AIåˆ†ææ¨¡å—	è°ƒç”¨ Supabase Edge Function æ¥å£	fetch() è°ƒç”¨ AI
5ï¸âƒ£ å›¾è¡¨å±•ç¤ºæ¨¡å—	æ¸²æŸ“EChartså›¾è¡¨é…ç½®	WebViewåŠ è½½ECharts
5ï¸âƒ£-1ï¸âƒ£ å›¾è¡¨é‡æ–°ç”Ÿæˆæ¨¡å—	åŸºäºå½“å‰é…ç½®é‡æ–°è°ƒç”¨ AI ç”Ÿæˆ	è°ƒç”¨ aiService.generateChart() é‡æ–°ç”Ÿæˆ
5ï¸âƒ£-2ï¸âƒ£ å›¾è¡¨ç±»å‹åˆ‡æ¢æ¨¡å—	æ‰‹åŠ¨åˆ‡æ¢å›¾è¡¨ç±»å‹ï¼ˆæŠ˜çº¿/æŸ±çŠ¶/é¥¼å›¾ç­‰ï¼‰	ä¿®æ”¹ series[0].type å¹¶é‡æ–°æ¸²æŸ“
5ï¸âƒ£-3ï¸âƒ£ AI æ´å¯Ÿæ¨¡å—	æ˜¾ç¤ºå›¾è¡¨æ•°æ®çš„æ™ºèƒ½åˆ†æå’Œå»ºè®®	è°ƒç”¨ AI æœåŠ¡ç”Ÿæˆæ•°æ®æ´å¯Ÿæ–‡æœ¬
6ï¸âƒ£ å›¾è¡¨å¯¼å‡ºæ¨¡å—	å¯¼å‡ºå›¾è¡¨ä¸º PNG / PDF / JSON	ECharts API + jsPDF + FileManager
7ï¸âƒ£ è®°å½•æ¨¡å—	å°†å›¾è¡¨é…ç½®ã€ç”Ÿæˆæ—¶é—´ç­‰å­˜æ•°æ®åº“	Supabase Database (PostgreSQL)

**ä¸“æ³¨ç®¡ç†æ¨¡å—**ï¼š
æ¨¡å—	åŠŸèƒ½è¯´æ˜	æŠ€æœ¯å®ç°
8ï¸âƒ£ Pomodoroè®¡æ—¶å™¨	25åˆ†é’Ÿä¸“æ³¨æ—¶é—´å€’è®¡æ—¶	ArkTS Timer + Progressç»„ä»¶
9ï¸âƒ£ ä»»åŠ¡ç®¡ç†æ¨¡å—	åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ä»»åŠ¡ï¼Œè¿½è¸ªå®ŒæˆçŠ¶æ€	dataPreferencesæœ¬åœ°å­˜å‚¨
ğŸ”Ÿ ä¸“æ³¨ç»Ÿè®¡æ¨¡å—	ä¸“æ³¨è¶‹åŠ¿ã€ä»»åŠ¡åˆ†å¸ƒã€å®Œæˆæœ€å¤šçš„ä»»åŠ¡	æ•°æ®èšåˆä¸å¯è§†åŒ–
ğŸ”Ÿ-1ï¸âƒ£ ä¸“æ³¨ AI æ´å¯Ÿæ¨¡å—	åŸºäºä¸“æ³¨æ—¶é—´æ•°æ®ç”Ÿæˆ AI åˆ†ææŠ¥å‘Šå’Œå»ºè®®	è°ƒç”¨ AI æœåŠ¡åˆ†æä¸“æ³¨æ¨¡å¼
1ï¸âƒ£1ï¸âƒ£ å¯åŠ¨é¡µæ¨¡å—	åº”ç”¨å¯åŠ¨æ—¶çš„åŠ è½½ç•Œé¢	ProgressåŠ¨ç”» + è·¯ç”±è·³è½¬

**é€šç”¨æ¨¡å—**ï¼š
æ¨¡å—	åŠŸèƒ½è¯´æ˜	æŠ€æœ¯å®ç°
1ï¸âƒ£2ï¸âƒ£ è®¾å¤‡é€‚é…æ¨¡å—	æ£€æµ‹è®¾å¤‡ç±»å‹ï¼Œæä¾›å“åº”å¼å¸ƒå±€	deviceInfo + display API
1ï¸âƒ£3ï¸âƒ£ é”™è¯¯å¤„ç†æ¨¡å—	ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸ç”¨æˆ·æç¤º	ErrorHandlerå·¥å…·ç±»
1ï¸âƒ£4ï¸âƒ£ å¼‚æ­¥ç®¡ç†æ¨¡å—	ä»»åŠ¡å–æ¶ˆã€è¶…æ—¶ã€é‡è¯•æœºåˆ¶	AsyncManagerå·¥å…·ç±»
äº”ã€è¯¦ç»†å®ç°æ­¥éª¤
é˜¶æ®µä¸€ï¼šå‰ç«¯åŸºç¡€ç»“æ„æ­å»º

åˆ›å»ºé¸¿è’™Appé¡¹ç›®ï¼›

é¡µé¢ç»“æ„ï¼š

LoginPage.etsï¼šç”¨æˆ·ç™»å½•/æ³¨å†Œï¼›

HomePage.etsï¼šä¸Šä¼ æˆ–è¾“å…¥æ•°æ®ï¼›

ChartPage.etsï¼šå±•ç¤ºAIç”Ÿæˆå›¾è¡¨ï¼›

ExportPage.etsï¼šå¯¼å‡ºå›¾è¡¨ã€‚

å¼•å…¥ EChartsï¼ˆé€šè¿‡æœ¬åœ° index.html + WebView åŠ è½½ï¼‰ã€‚

é˜¶æ®µäºŒï¼šæ¥å…¥ Supabase

åœ¨é¡¹ç›®ä¸­å¼•å…¥ Supabase SDKï¼ˆTypeScript ç‰ˆæœ¬ï¼‰ï¼š

import { createClient } from '@supabase/supabase-js'

const supabaseUrl = 'https://your-project-id.supabase.co'
const supabaseKey = 'public-anon-key'
export const supabase = createClient(supabaseUrl, supabaseKey)

åŠŸèƒ½å®ç°ï¼š

ç”¨æˆ·ç™»å½•æ³¨å†Œ (supabase.auth.signInWithPassword)

ä¸Šä¼ æ–‡ä»¶ (supabase.storage.from('datasets').upload(...))

æ•°æ®å­˜å– (supabase.from('charts').select())

é˜¶æ®µä¸‰ï¼šäº‘ç«¯ AI è°ƒç”¨é€»è¾‘ï¼ˆQwenï¼‰

åœ¨ Supabase ä¸­åˆ›å»º Edge Functionï¼ˆServerlesså‡½æ•°ï¼‰ï¼Œå‘½åä¸º generate_chartï¼ˆæˆ– generate_chart_qwenï¼‰ï¼š

å‡½æ•°é€»è¾‘ï¼ˆç¤ºä¾‹ï¼ŒQwen OpenAI å…¼å®¹æ¥å£ï¼‰ï¼š
// /supabase/functions/generate_chart_qwen.ts
import { Ajv } from "https://esm.sh/ajv";
import userDataSchema from "./schemas/userData.schema.json" assert { type: "json" };
import chartConfigSchema from "./schemas/chartConfig.schema.json" assert { type: "json" };

const ajv = new Ajv({ allErrors: true });
const validateIn = ajv.compile(userDataSchema);
const validateOut = ajv.compile(chartConfigSchema);

const API_BASE = Deno.env.get("DASHSCOPE_API_BASE")?.replace(/\/$/, "") ||
  "https://dashscope.aliyuncs.com/compatible-mode/v1";
const API_KEY = Deno.env.get("DASHSCOPE_API_KEY");
const MODEL = Deno.env.get("QWEN_MODEL") || "qwen-plus";

const systemPrompt = `ä½ æ˜¯æ•°æ®å¯è§†åŒ–ä¸“å®¶ã€‚ä¾æ®ç”¨æˆ·æä¾›çš„æ•°æ®ç”Ÿæˆä¸¥æ ¼ç¬¦åˆ ECharts çš„ JSONï¼›ä¸è¦è¾“å‡ºä»»ä½•é JSON æ–‡æœ¬ã€‚`;

async function callQwen(messages: Array<{ role: string; content: string }>) {
  const res = await fetch(`${API_BASE}/chat/completions`, {
    method: "POST",
    headers: { "Authorization": `Bearer ${API_KEY}`, "Content-Type": "application/json" },
    body: JSON.stringify({ model: MODEL, temperature: 0, response_format: { type: "json_object" }, messages })
  });
  const data = await res.json();
  return data?.choices?.[0]?.message?.content;
}

export default Deno.serve(async (req) => {
  const body = await req.json();
  if (!validateIn(body)) return new Response(JSON.stringify({ code: "INVALID_INPUT", errors: validateIn.errors }), { status: 400 });
  const content = await callQwen([
    { role: "system", content: systemPrompt },
    { role: "user", content: typeof body === "string" ? body : JSON.stringify(body) },
  ]);
  try {
    const json = JSON.parse(content || "{}");
    if (!validateOut(json)) return new Response(JSON.stringify({ code: "INVALID_MODEL_OUTPUT" }), { status: 502 });
    return new Response(JSON.stringify(json), { headers: { "Content-Type": "application/json" } });
  } catch {
    return new Response(JSON.stringify({ code: "INVALID_JSON_OUTPUT" }), { status: 502 });
  }
})


â¡ï¸ è¿™æ ·é¸¿è’™å‰ç«¯åªéœ€è°ƒç”¨ï¼š

const res = await fetch('https://your-project.supabase.co/functions/v1/generate_chart', {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${token}` },
  body: JSON.stringify({ data: userData })
})
const chartConfig = await res.json()

é˜¶æ®µå››ï¼šå›¾è¡¨æ¸²æŸ“ä¸å¯¼å‡º

åœ¨é¸¿è’™å‰ç«¯é€šè¿‡ WebView åŠ è½½ ECharts é¡µé¢ï¼Œå¹¶ä¼ å…¥ JSON é…ç½®ï¼š

chart.setOption(chartConfig)


å¯¼å‡ºåŠŸèƒ½ï¼š

const img = chart.getDataURL({ type: 'png', backgroundColor: '#fff' })
await fileAccess.saveImage(img, 'chart.png')

é˜¶æ®µäº”ï¼šç»“æœå­˜å‚¨ä¸å±•ç¤º

æ¯æ¬¡ç”Ÿæˆå›¾è¡¨åï¼Œå°†å…ƒä¿¡æ¯å†™å…¥ Supabase æ•°æ®åº“ï¼š

await supabase.from('charts').insert({
  user_id: user.id,
  title: chartConfig.title.text,
  type: chartConfig.series[0].type,
  created_at: new Date(),
  chart_json: chartConfig
})


ç”¨æˆ·å¯ä»¥åœ¨å†å²è®°å½•é¡µæŸ¥çœ‹å†å²å›¾è¡¨ã€‚

å…­ã€æ•°æ®åº“ç»“æ„è®¾è®¡ï¼ˆSupabase PostgreSQLï¼‰
è¡¨å	å­—æ®µå	ç±»å‹	æè¿°
users	id	uuid	ç”¨æˆ·å”¯ä¸€ID
	email	text	ç™»å½•é‚®ç®±
	created_at	timestamp	æ³¨å†Œæ—¶é—´
charts	id	uuid	å›¾è¡¨ID
	user_id	uuid	ç”¨æˆ·å…³è”
	title	text	å›¾è¡¨æ ‡é¢˜
	type	text	å›¾è¡¨ç±»å‹
	chart_json	jsonb	å›¾è¡¨é…ç½®
	created_at	timestamp	ç”Ÿæˆæ—¶é—´
ä¸ƒã€æŠ€æœ¯é€‰å‹
æ¨¡å—	æŠ€æœ¯	è¯´æ˜
å‰ç«¯æ¡†æ¶	ArkTSï¼ˆHarmonyOSï¼‰	é¸¿è’™åŸç”Ÿå¼€å‘
å›¾è¡¨æ¸²æŸ“	ECharts	WebViewåµŒå…¥
åç«¯æœåŠ¡	Supabase (Edge Function + DB)	æ— éœ€è‡ªè¡Œéƒ¨ç½²
AI æ¨¡å‹	é€šä¹‰åƒé—®ï¼ˆQwenï¼‰	ç”ŸæˆEChartsé…ç½®
æ•°æ®å­˜å‚¨	Supabase Storage	æ–‡ä»¶ä¸Šä¼ 
æ•°æ®åº“	Supabase PostgreSQL	å­˜å‚¨å›¾è¡¨æ•°æ®
å¯¼å‡ºæ¨¡å—	ECharts API / jsPDF	å›¾è¡¨å¯¼å‡ºåŠŸèƒ½
å…«ã€é¡¹ç›®ç»“æ„è§„åˆ’
project-root/
â”œâ”€ pages/
â”‚  â”œâ”€ SplashPage.ets          # å¯åŠ¨é¡µ
â”‚  â”œâ”€ Index.ets               # é¦–é¡µï¼ˆæ•°æ®è¾“å…¥å…¥å£ï¼‰
â”‚  â”œâ”€ LoginPage.ets           # ç”¨æˆ·ç™»å½•/æ³¨å†Œ
â”‚  â”œâ”€ HomePage.ets            # æ•°æ®è¾“å…¥ä¸å¤„ç†é€»è¾‘
â”‚  â”œâ”€ ChartPage.ets           # å›¾è¡¨å±•ç¤ºé¡µ
â”‚  â”œâ”€ HistoryPage.ets         # å†å²è®°å½•é¡µ
â”‚  â”œâ”€ FocusPage.ets           # Pomodoroä¸»ç•Œé¢
â”‚  â”œâ”€ FocusTimerPage.ets      # Pomodoroè®¡æ—¶å™¨é¡µ
â”‚  â””â”€ ProgressPage.ets        # ä¸“æ³¨è¿›åº¦ç»Ÿè®¡é¡µ
â”‚
â”œâ”€ utils/
â”‚  â”œâ”€ supabaseClient.ets      # Supabaseå®¢æˆ·ç«¯å°è£…
â”‚  â”œâ”€ aiService.ets           # AIæœåŠ¡è°ƒç”¨å°è£…
â”‚  â”œâ”€ fileManager.ets         # æ–‡ä»¶ç®¡ç†ï¼ˆPNG/PDF/JSONå¯¼å‡ºï¼‰
â”‚  â”œâ”€ pomodoroService.ets     # PomodoroæœåŠ¡ï¼ˆä»»åŠ¡/ä¼šè¯ç®¡ç†ï¼‰
â”‚  â”œâ”€ deviceAdapter.ets       # è®¾å¤‡é€‚é…å·¥å…·
â”‚  â”œâ”€ errorHandler.ets        # é”™è¯¯å¤„ç†å·¥å…·
â”‚  â”œâ”€ asyncManager.ets        # å¼‚æ­¥ä»»åŠ¡ç®¡ç†
â”‚  â”œâ”€ httpClient.ets          # HTTPè¯·æ±‚å°è£…
â”‚  â”œâ”€ config.ets              # é…ç½®ç®¡ç†
â”‚  â”œâ”€ metrics.ets              # æ€§èƒ½æŒ‡æ ‡æ”¶é›†
â”‚  â””â”€ performanceMonitor.ets  # æ€§èƒ½ç›‘æ§
â”‚
â”œâ”€ resources/
â”‚  â”œâ”€ base/
â”‚  â”‚  â”œâ”€ element/             # èµ„æºå®šä¹‰
â”‚  â”‚  â”œâ”€ media/               # å›¾ç‰‡èµ„æº
â”‚  â”‚  â””â”€ profile/             # é¡µé¢é…ç½®
â”‚  â””â”€ rawfile/
â”‚     â”œâ”€ chart.html           # EChartså®¹å™¨
â”‚     â””â”€ supabase.json        # Supabaseé…ç½®ï¼ˆæœ¬åœ°ï¼‰
â”‚
â””â”€ supabase/
   â”œâ”€ functions/
   â”‚  â””â”€ generate_chart_qwen/  # Edge Functionï¼ˆAIå›¾è¡¨ç”Ÿæˆï¼‰
   â””â”€ types/
      â””â”€ database.types.ts    # æ•°æ®åº“ç±»å‹å®šä¹‰

ä¹ã€æœªæ¥æ‰©å±•æ–¹å‘

AI è‡ªåŠ¨ç”Ÿæˆå›¾è¡¨åˆ†æè¯´æ˜ï¼›

å›¾è¡¨æ¨¡æ¿ä¸æ ·å¼ä¸­å¿ƒï¼›

å¤šäººåä½œä¸æ•°æ®å…±äº«ï¼›

æ”¯æŒè¯­éŸ³è¾“å…¥ã€è‡ªåŠ¨é¢„æµ‹è¶‹åŠ¿ï¼›

å›¾è¡¨äº‘ç«¯åŒæ­¥ä¸åˆ†äº«é“¾æ¥ã€‚

åã€é¢„æœŸæˆæœ

âœ… ç”¨æˆ·å¯åœ¨é¸¿è’™Appå†…è¾“å…¥æ•°æ®å¹¶è‡ªåŠ¨ç”Ÿæˆå›¾è¡¨ï¼›
âœ… å›¾è¡¨å¯ç›´æ¥å¯¼å‡ºã€ä¿å­˜ã€äº‘ç«¯å¤‡ä»½ï¼›
âœ… Supabase ä¿éšœç”¨æˆ·å®‰å…¨ç™»å½•ä¸æ•°æ®ç®¡ç†ï¼›
âœ… æ— éœ€ç‹¬ç«‹åç«¯éƒ¨ç½²ï¼Œç³»ç»Ÿç»´æŠ¤ç®€å•ï¼›
âœ… æ¶æ„çµæ´»ï¼Œä¾¿äºæ‰©å±• AI åŠŸèƒ½ä¸å¯è§†åŒ–èƒ½åŠ›ã€‚

å-1ã€å½“å‰å®ç°çŠ¶æ€ï¼ˆ2025-01-28 æ›´æ–°ï¼‰

âœ… **æ‰€æœ‰30ä¸ªä»»åŠ¡å·²å®Œæˆæ ‡è®°ï¼ˆT001-T030ï¼‰**

**å·²å®Œæˆçš„æ ¸å¿ƒæ¨¡å—ï¼š**

1. **å‰ç«¯å·¥å…·æ¨¡å—**
   - âœ… `entry/src/main/ets/utils/supabaseClient.ets` - Supabaseå®¢æˆ·ç«¯å°è£…
   - âœ… `entry/src/main/ets/utils/aiService.ets` - AIæœåŠ¡è°ƒç”¨å°è£…ï¼ˆå«é”™è¯¯å¤„ç†ï¼‰
   - âœ… `entry/src/main/ets/utils/fileManager.ets` - æ–‡ä»¶ç®¡ç†å·¥å…·ï¼ˆPNG/PDF/JSONå¯¼å‡ºï¼‰
   - âœ… `entry/src/main/ets/utils/pomodoroService.ets` - PomodoroæœåŠ¡ï¼ˆä»»åŠ¡/ä¼šè¯ç®¡ç†ï¼‰
   - âœ… `entry/src/main/ets/utils/deviceAdapter.ets` - è®¾å¤‡é€‚é…å·¥å…·
   - âœ… `entry/src/main/ets/utils/errorHandler.ets` - é”™è¯¯å¤„ç†å·¥å…·
   - âœ… `entry/src/main/ets/utils/asyncManager.ets` - å¼‚æ­¥ä»»åŠ¡ç®¡ç†

2. **æ•°æ®å¯è§†åŒ–é¡µé¢æ¨¡å—**
   - âœ… `entry/src/main/ets/pages/Index.ets` - é¦–é¡µï¼ˆæ•°æ®è¾“å…¥å…¥å£ï¼‰
   - âœ… `entry/src/main/ets/pages/HomePage.ets` - æ•°æ®è¾“å…¥ä¸å¤„ç†é€»è¾‘
   - âœ… `entry/src/main/ets/pages/ChartPage.ets` - å›¾è¡¨æ¸²æŸ“é¡µï¼ˆæ”¯æŒé…ç½®è®¾ç½®ä¸å¯¼å‡ºï¼‰
   - âœ… `entry/src/main/ets/pages/HistoryPage.ets` - å†å²è®°å½•é¡µï¼ˆåˆ—è¡¨å±•ç¤ºä¸å¯¼èˆªï¼‰
   - âœ… `entry/src/main/ets/pages/LoginPage.ets` - ç”¨æˆ·ç™»å½•/æ³¨å†Œé¡µ

3. **ä¸“æ³¨ç®¡ç†é¡µé¢æ¨¡å—**
   - âœ… `entry/src/main/ets/pages/FocusPage.ets` - Pomodoroä¸»ç•Œé¢ï¼ˆä»»åŠ¡åˆ—è¡¨ã€ä»Šæ—¥è¿›åº¦ï¼‰
   - âœ… `entry/src/main/ets/pages/FocusTimerPage.ets` - Pomodoroè®¡æ—¶å™¨é¡µï¼ˆå€’è®¡æ—¶ã€æš‚åœ/ç»§ç»­ï¼‰
   - âœ… `entry/src/main/ets/pages/ProgressPage.ets` - ä¸“æ³¨è¿›åº¦ç»Ÿè®¡é¡µï¼ˆè¶‹åŠ¿ã€åˆ†å¸ƒã€Topä»»åŠ¡ï¼‰

4. **å¯åŠ¨é¡µæ¨¡å—**
   - âœ… `entry/src/main/ets/pages/SplashPage.ets` - åº”ç”¨å¯åŠ¨é¡µï¼ˆåŠ è½½åŠ¨ç”»ï¼‰

5. **Edge Function**
   - âœ… `supabase/functions/generate_chart_qwen.ts` - Qwenæ¨¡å‹è°ƒç”¨å‡½æ•°
   - âœ… åŒ…å«å®Œæ•´çš„å…¥/å‡ºå‚Schemaæ ¡éªŒï¼ˆAjvï¼‰
   - âœ… è¶…æ—¶æ§åˆ¶ï¼ˆ3ç§’ï¼‰ã€é”™è¯¯å¤„ç†ä¸é™çº§æ¨¡æ¿
   - âœ… ç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼ˆrequestIdã€è€—æ—¶è¿½è¸ªï¼‰

6. **è§„èŒƒæ–‡æ¡£**
   - âœ… `specs/001-ai-chart-mvp/contracts/openapi.yaml` - APIè§„èŒƒå®šä¹‰
   - âœ… `specs/001-ai-chart-mvp/contracts/schemas/userData.schema.json` - è¾“å…¥æ•°æ®Schema
   - âœ… `specs/001-ai-chart-mvp/contracts/schemas/chartConfig.schema.json` - è¾“å‡ºé…ç½®Schema

**å·²ä¸Šçº¿çš„åŸºç¡€è®¾æ–½ï¼š**
- âœ… Supabase æ•°æ®åº“è¡¨ä¸ RLS ç­–ç•¥å·²åº”ç”¨
- âœ… Edge Function å·²éƒ¨ç½²ï¼Œå¯é€šè¿‡ç”Ÿäº§ URL è°ƒç”¨
- âœ… TypeScript ç±»å‹å®šä¹‰å·²ç”Ÿæˆå¹¶ä¿å­˜

**å¾…é›†æˆé¡¹ï¼ˆéœ€HarmonyOSåŸç”ŸAPIé›†æˆï¼‰ï¼š**
- â³ WebViewæ¡¥æ¥å®ç°ï¼ˆEChartsæ¸²æŸ“ï¼‰
- â³ HarmonyOSæ–‡ä»¶APIé›†æˆï¼ˆå®é™…æ–‡ä»¶ä¿å­˜ï¼‰
- â³ Supabase SDKå®é™…åˆå§‹åŒ–ï¼ˆéœ€é…ç½®ç”Ÿäº§ç¯å¢ƒURLä¸anon keyï¼‰
- â³ è®¤è¯tokenç®¡ç†ä¸Edge URLé…ç½®è¯»å–

**å¾…å®ç°çš„åŠŸèƒ½æŒ‰é’®ï¼ˆæ ¹æ®ç•Œé¢è®¾è®¡è¡¥å……ï¼‰ï¼š**

1. **é¦–é¡µï¼ˆIndex.etsï¼‰æ•°æ®è¾“å…¥æ¨¡å—**ï¼š
   - â³ "ä½¿ç”¨æ ·æœ¬æ•°æ®" æŒ‰é’®ï¼ˆUse Sample Dataï¼‰
     - åŠŸèƒ½ï¼šæä¾›é¢„è®¾çš„ç¤ºä¾‹æ•°æ®é›†ï¼Œç”¨æˆ·å¯ä¸€é”®åŠ è½½å¹¶ç”Ÿæˆç¤ºä¾‹å›¾è¡¨
     - å®ç°ï¼šåœ¨ `Index.ets` ä¸­æ·»åŠ æŒ‰é’®ï¼Œç‚¹å‡»ååŠ è½½é¢„è®¾çš„ JSON/CSV æ ·æœ¬æ•°æ®åˆ°è¾“å…¥æ¡†
   - â³ "æ‰‹åŠ¨è¾“å…¥" æŒ‰é’®ï¼ˆManual Inputï¼‰
     - åŠŸèƒ½ï¼šæ˜ç¡®æ ‡è¯†æ‰‹åŠ¨è¾“å…¥å…¥å£ï¼ˆå½“å‰å·²æœ‰æ–‡æœ¬è¾“å…¥åŒºåŸŸï¼Œå¯ä¼˜åŒ–ä¸ºæŒ‰é’®å¼å…¥å£ï¼‰
     - å®ç°ï¼šä¼˜åŒ–ç°æœ‰æ–‡æœ¬è¾“å…¥åŒºåŸŸçš„è§†è§‰å‘ˆç°ï¼Œæˆ–æ·»åŠ æ˜ç¡®çš„"æ‰‹åŠ¨è¾“å…¥"æŒ‰é’®

2. **å›¾è¡¨é¢„è§ˆé¡µï¼ˆChartPage.etsï¼‰æ§åˆ¶åŠŸèƒ½**ï¼š
   - â³ "é‡æ–°ç”Ÿæˆ" æŒ‰é’®ï¼ˆRegenerateï¼‰
     - åŠŸèƒ½ï¼šåŸºäºå½“å‰å›¾è¡¨é…ç½®é‡æ–°è°ƒç”¨ AI ç”Ÿæˆæ–°çš„å›¾è¡¨é…ç½®
     - å®ç°ï¼šåœ¨ `ChartPage.ets` ä¸­æ·»åŠ æŒ‰é’®ï¼Œè°ƒç”¨ `aiService.generateChart()` é‡æ–°ç”Ÿæˆ
   - â³ "æ›´æ”¹ç±»å‹" æŒ‰é’®ï¼ˆChange Typeï¼‰
     - åŠŸèƒ½ï¼šå…è®¸ç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢å›¾è¡¨ç±»å‹ï¼ˆå¦‚æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€é¥¼å›¾ç­‰ï¼‰
     - å®ç°ï¼šåœ¨ `ChartPage.ets` ä¸­æ·»åŠ æŒ‰é’®ï¼Œå¼¹å‡ºå›¾è¡¨ç±»å‹é€‰æ‹©å™¨ï¼Œä¿®æ”¹å½“å‰é…ç½®çš„ `series[0].type`
   - â³ "AI æ´å¯Ÿ" éƒ¨åˆ†ï¼ˆAI Insightsï¼‰
     - åŠŸèƒ½ï¼šæ˜¾ç¤º AI å¯¹å½“å‰å›¾è¡¨æ•°æ®çš„æ™ºèƒ½åˆ†æå’Œæ´å¯Ÿå»ºè®®
     - å®ç°ï¼šåœ¨ `ChartPage.ets` ä¸­æ·»åŠ  AI æ´å¯Ÿå¡ç‰‡ï¼Œè°ƒç”¨ AI æœåŠ¡ç”Ÿæˆæ•°æ®æ´å¯Ÿæ–‡æœ¬

3. **ä¸“æ³¨è¿›åº¦ç»Ÿè®¡é¡µï¼ˆProgressPage.etsï¼‰å¢å¼ºåŠŸèƒ½**ï¼š
   - â³ "AI æ´å¯Ÿ" æŒ‰é’®ï¼ˆåœ¨ Total Focus Time éƒ¨åˆ†ï¼‰
     - åŠŸèƒ½ï¼šåŸºäºä¸“æ³¨æ—¶é—´æ•°æ®ç”Ÿæˆ AI åˆ†ææŠ¥å‘Šå’Œå»ºè®®
     - å®ç°ï¼šåœ¨ `ProgressPage.ets` çš„"æ€»ä¸“æ³¨æ—¶é—´"å¡ç‰‡ä¸­æ·»åŠ æŒ‰é’®ï¼Œè°ƒç”¨ AI æœåŠ¡åˆ†æä¸“æ³¨æ¨¡å¼

**ä»£ç è´¨é‡ä¸åº¦é‡ï¼š**
- âœ… æ— linteré”™è¯¯
- âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ¨¡å—åŒ–è‰¯å¥½
- âœ… é”™è¯¯å¤„ç†å®Œæ•´ï¼Œä¸­æ–‡æç¤ºç»Ÿä¸€
- âœ… ç¬¦åˆè§„èŒƒè¦æ±‚ï¼ˆSchemaæ ¡éªŒã€äº‘ç«¯ä¼˜å…ˆã€å®‰å…¨åˆè§„ï¼‰
- âœ… å·²æ¥å…¥å®¢æˆ·ç«¯æ€§èƒ½åŸ‹ç‚¹ï¼š`utils/metrics.ets`ï¼›åœ¨ `aiService.generateChart` è®°å½• `requestId/duration/ok`
- âœ… å¤šè®¾å¤‡é€‚é…æ”¯æŒï¼ˆphone/tablet/2in1/tv/wearable/car/smartVisionï¼‰
- â³ é¦–æ¬¡ P95 ç»Ÿè®¡å°†åœ¨æ¼”ç¤ºåè¡¥å……è‡³æœ¬èŠ‚

å-2ã€MCP æœåŠ¡é›†æˆï¼ˆ2025-10-29 æ›´æ–°ï¼‰

- å·²ä¿®å¤ `.cursor/mcp.json` é…ç½®ç»“æ„ï¼Œæ¥å…¥ä»¥ä¸‹ MCP æœåŠ¡ï¼š
  - `chrome-devtools`ï¼šç”¨äºé¡µé¢è”åŠ¨ä¸è°ƒè¯•è¾…åŠ©
  - `supabase`ï¼šç”¨äºæŸ¥è¯¢é¡¹ç›®çŠ¶æ€ã€ç±»å‹ç”Ÿæˆã€æ—¥å¿—ä¸å»ºè®®è·å–
- å½“å‰çŠ¶æ€ï¼šéœ€è¦å®Œæˆæƒé™æˆæƒåæ–¹å¯åœ¨ Cursor ä¸­ç›´æ¥è°ƒç”¨ Supabase MCPï¼ˆé¿å…åœ¨æ–‡æ¡£æˆ–ä»£ç ä¸­æš´éœ²å¯†é’¥ï¼‰ã€‚
- æˆæƒæ–¹å¼ï¼ˆäºŒé€‰ä¸€ï¼‰ï¼š
  1) åœ¨ Cursor è®¾ç½®ä¸­ä¸º Supabase MCP å®Œæˆè´¦å·ç»‘å®š/æˆæƒï¼›
  2) ä½¿ç”¨ Cursor Secrets/ç¯å¢ƒå˜é‡æ³¨å…¥è®¿é—®ä»¤ç‰Œï¼Œä»…åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒç”Ÿæ•ˆã€‚

å-3ã€MCP æ‹‰å–ç»“æœï¼ˆ2025-10-29 å®æ—¶ï¼‰

- é¡¹ç›® URLï¼š`https://ugeyrsnrmxjyoflkaapk.supabase.co`
- Edge Functionsï¼šâœ… `generate_chart_qwen` å·²æˆåŠŸéƒ¨ç½²è‡³ç”Ÿäº§ç¯å¢ƒ
  - éƒ¨ç½²å‘½ä»¤ï¼š`supabase functions deploy generate_chart_qwen --no-verify-jwt`
  - å‡½æ•°å…¥å£ï¼š`supabase/functions/generate_chart_qwen/index.ts`
  - ç›‘æ§é¢æ¿ï¼šhttps://supabase.com/dashboard/project/ugeyrsnrmxjyoflkaapk/functions
- æ•°æ®åº“ï¼šâœ… `charts` è¡¨å·²åˆ›å»ºå¹¶å¯ç”¨ RLS
  - è¿ç§»åç§°ï¼š`create_charts_table_and_rls`
  - ç­–ç•¥ï¼šç”¨æˆ·ä»…å¯è®¿é—®è‡ªå·±çš„å›¾è¡¨è®°å½•ï¼ˆSELECT/INSERT/UPDATE/DELETEï¼‰
- ç±»å‹å®šä¹‰ï¼šâœ… å·²ç”Ÿæˆå¹¶ä¿å­˜è‡³ `supabase/types/database.types.ts`
- å®‰å…¨å»ºè®®ï¼šâœ… æ— ï¼ˆMCP advisors æœªè¿”å›é—®é¢˜ï¼‰
- æ€§èƒ½å»ºè®®ï¼šâœ… æ— ï¼ˆMCP advisors æœªè¿”å›é—®é¢˜ï¼‰

å-4ã€ç”Ÿäº§ç¯å¢ƒä¸Šçº¿å‡†å¤‡æ¸…å•ï¼ˆ2025-10-29ï¼‰

**å·²å®Œæˆçš„éƒ¨ç½²é¡¹ï¼š**
- âœ… æ•°æ®åº“è¡¨ç»“æ„ä¸ RLS ç­–ç•¥å·²åº”ç”¨ï¼ˆ`charts` è¡¨ï¼‰
- âœ… Edge Function `generate_chart_qwen` å·²éƒ¨ç½²è‡³ç”Ÿäº§
- âœ… TypeScript ç±»å‹å®šä¹‰å·²ç”Ÿæˆå¹¶ä¿å­˜

**å¾…é…ç½®çš„ç¯å¢ƒå˜é‡ï¼ˆéœ€åœ¨ Supabase Dashboard è®¾ç½®ï¼‰ï¼š**
1. `DASHSCOPE_API_KEY`ï¼ˆå¿…å¡«ï¼‰- é€šä¹‰åƒé—® API å¯†é’¥
2. `QWEN_MODEL`ï¼ˆå¯é€‰ï¼Œé»˜è®¤ `qwen-plus`ï¼‰- ä½¿ç”¨çš„æ¨¡å‹åç§°
3. `DASHSCOPE_API_BASE`ï¼ˆå¯é€‰ï¼Œé»˜è®¤å…¼å®¹ç«¯ç‚¹ï¼‰- API åŸºç¡€ URL

**å¾…å®Œæˆé¡¹ï¼š**
- â³ Storage Bucket åˆ›å»ºï¼ˆå¦‚éœ€è¦æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼‰
- â³ HarmonyOS åº”ç”¨æ‰“åŒ…ã€ç­¾åä¸æ¸ é“åˆ†å‘
- â³ å‰ç«¯é…ç½®ç”Ÿäº§ç¯å¢ƒ URL ä¸å¯†é’¥ï¼ˆé€šè¿‡ AppScope å®‰å…¨å­˜å‚¨ï¼‰

**å‘å¸ƒä¸é…ç½®æ£€æŸ¥æ¸…å•ï¼ˆæ–°å¢ï¼Œé‰´æƒä¸å¤šç¯å¢ƒï¼‰**

- å‰ç«¯åªæŒæœ‰ `SUPABASE_ANON_KEY`ï¼Œè°ƒç”¨ Edge æ—¶åœ¨è¯·æ±‚å¤´åŒæ—¶è®¾ç½®ï¼š
  - `Authorization: Bearer <anon key>`
  - `apikey: <anon key>`
- Edge Function `generate_chart_qwen` å·²éƒ¨ç½²å¹¶ä¿æŒ `verify_jwt=true`ï¼›ç›‘æ§é¢æ¿å¯è§è°ƒç”¨æ—¥å¿—
- URL é€šè¿‡ `getSupabaseUrl()` åŠ¨æ€æ‹¼æ¥ `/functions/v1/generate_chart_qwen`ï¼Œä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å®Œæ•´åŸŸå
- AppScope/æ„å»ºå˜é‡å·²æ³¨å…¥ï¼š`SUPABASE_URL`ã€`SUPABASE_ANON_KEY`ï¼Œå¹¶åŒºåˆ† dev/staging/prod ä¸‰å¥—
- ç«¯åˆ°ç«¯è”è°ƒç”¨ä¾‹ï¼š
  - 401ï¼šanon key ç¼ºå¤±/é”™è¯¯ â†’ å‹å¥½æç¤ºå¹¶å¯é‡è¯•
  - 404ï¼šå‡½æ•°æœªæ‰¾åˆ°/è·¯å¾„é”™è¯¯ â†’ å‹å¥½æç¤ºå¹¶è®°å½•æ—¥å¿—
  - 504ï¼šAI è¶…æ—¶ â†’ å®¢æˆ·ç«¯é‡‡ç”¨å›é€€æ¨¡æ¿æ¸²æŸ“
- åˆçº¦ä¸€è‡´æ€§ï¼š`contracts/openapi.yaml` ä½¿ç”¨ `x-operation-id: generate_chart_qwen`ï¼Œè·¯å¾„å¯ä¸ºç»Ÿä¸€åˆ«å `generate_chart`


**å‰ç«¯é…ç½®è½åœ°ï¼ˆæ–°å¢ 2025-10-29ï¼‰**

- æ–°å¢è¿è¡Œæ—¶é…ç½®æ³¨å…¥ï¼š
  - `entry/src/main/ets/utils/config.ets` æä¾›å…¨å±€ `setAppConfig/getAppConfig`
  - `EntryAbility.onCreate` å¯åŠ¨æ—¶è¯»å– `rawfile/supabase.json` å¹¶æ³¨å…¥ URL ä¸ anon key
  - `supabaseClient.ets` æ”¹ä¸ºä»è¿è¡Œæ—¶é…ç½®è¯»å– `getSupabaseUrl/getSupabaseAnonKey`
- æœ¬åœ°éœ€è¦å¡«å†™ï¼š`entry/src/main/resources/rawfile/supabase.json`
  - ç¤ºä¾‹ï¼š`{"supabaseUrl":"https://<your>.supabase.co","anonKey":"<your-anon-key>"}`
  - anon key ä¸ºå…¬å¼€å¯†é’¥ï¼Œå¯æ”¾å…¥å®¢æˆ·ç«¯ï¼›æœåŠ¡ç«¯å¯†é’¥ä»ä»…åœ¨ Edge Function

åä¸€ã€ä¸ spec-kit é›†æˆæ–¹æ¡ˆ

ç›®æ ‡ï¼šä»¥â€œè§„èŒƒå…ˆè¡Œâ€çš„æ–¹å¼å›ºåŒ–æ¥å£ã€æ•°æ®ç»“æ„ä¸é¡µé¢å¥‘çº¦ï¼Œä¿éšœå‰åç«¯/å‡½æ•°é—´ä¸€è‡´æ€§ï¼Œå¹¶å®ç°è‡ªåŠ¨æ ¡éªŒä¸ä»£ç ç”Ÿæˆã€‚

1. è§„èŒƒäº§ç‰©
- API è§„èŒƒï¼šOpenAPIï¼ˆgenerate_chartã€é‰´æƒã€æ–‡ä»¶ä¸Šä¼ ä»£ç†ç­‰ï¼‰
- æ•°æ®å¥‘çº¦ï¼šå›¾è¡¨é…ç½®ä¸ç”¨æˆ·æ•°æ®çš„ JSON Schemaï¼ˆæˆ– Zodï¼‰
- Edge Function è§„èŒƒï¼šå…¥å‚ä¸å‡ºå‚ Schemaã€é”™è¯¯ç çº¦å®š
- å‰ç«¯é¡µé¢è§„èŒƒï¼šé¡µé¢äº‹ä»¶/çŠ¶æ€æœºï¼ˆå¯ç”¨ YAML/JSON æè¿°äº¤äº’æµç¨‹ï¼‰

2. ç›®å½•è§„åˆ’ï¼ˆå»ºè®®ï¼‰
project-root/
- specs/
  - api.openapi.yaml           # REST/Edge Functions æ¥å£è§„èŒƒ
  - schemas/
    - chartConfig.schema.json  # ECharts é…ç½®å¥‘çº¦
    - userData.schema.json     # ä¸Šä¼ æ•°æ®å¥‘çº¦
  - pages/
    - ChartPage.spec.json      # é¡µé¢çŠ¶æ€/äº‹ä»¶è§„èŒƒ

3. å·¥ä½œæµ
- è§„èŒƒç¼–å†™/æ›´æ–° â†’ è§„èŒƒæ ¡éªŒï¼ˆspec-kit lint/validateï¼‰â†’ ä»£ç ç”Ÿæˆï¼ˆå®¢æˆ·ç«¯ç±»å‹/æœåŠ¡ç«¯å®ˆå«ï¼‰â†’ å®ç°/è”è°ƒ â†’ åˆçº¦æµ‹è¯•ï¼ˆcontract testsï¼‰â†’ å‘ç‰ˆ

4. ç”Ÿæˆç‰©è½åœ°
- å‰ç«¯ ArkTS ç±»å‹å®šä¹‰ï¼šç”± JSON Schema/OpenAPI ç”Ÿæˆ `.d.ts`/ArkTS æ¥å£
- Edge Function å…¥å‚æ ¡éªŒï¼šç”Ÿæˆ Deno è¿è¡Œæ—¶æ ¡éªŒé€»è¾‘ï¼ˆå¦‚ Ajvï¼‰
- é”™è¯¯ç ä¸æ–‡æ¡ˆï¼šç»Ÿä¸€ä»è§„èŒƒå¯¼å‡ºå¸¸é‡ï¼Œé¿å…åˆ†æ•£ç»´æŠ¤

5. CI é›†æˆ
- åœ¨ CI ä¸­æ‰§è¡Œ `spec-kit validate` ä¸åˆçº¦æµ‹è¯•ï¼›è§„èŒƒæœªé€šè¿‡ç¦æ­¢åˆå…¥

6. **ä½¿ç”¨ spec-kit æ›´æ–°æ–‡æ¡£çš„æ­¥éª¤**ï¼ˆ2025-01-28 æ›´æ–°ï¼‰

åœ¨å®Œæˆå®ç°åï¼Œä½¿ç”¨ä»¥ä¸‹ spec-kit å‘½ä»¤å¯¹æ–‡æ¡£è¿›è¡Œæ•´ä½“æ›´æ–°å’ŒéªŒè¯ï¼š

**æ­¥éª¤1ï¼šåˆ†æä¸€è‡´æ€§**
```bash
# åœ¨ Cursor ä¸­ä½¿ç”¨å‘½ä»¤ï¼š
/speckit.analyze
```
- æ£€æŸ¥ spec.mdã€plan.mdã€tasks.md ä¹‹é—´çš„ä¸€è‡´æ€§
- è¯†åˆ«é‡å¤ã€æ­§ä¹‰å’Œæœªæ˜ç¡®é¡¹
- è¾“å‡ºåˆ†ææŠ¥å‘Šï¼ˆä¸ä¿®æ”¹æ–‡ä»¶ï¼‰

**æ­¥éª¤2ï¼šéªŒè¯è§„èŒƒå¥‘çº¦**
```bash
# éªŒè¯ OpenAPI å’Œ Schema æ–‡ä»¶
# éœ€è¦ç¡®ä¿ contracts/ ç›®å½•ä¸‹çš„æ–‡ä»¶ç¬¦åˆè§„èŒƒ
```
- æ£€æŸ¥ `contracts/openapi.yaml` çš„å®Œæ•´æ€§
- éªŒè¯ `contracts/schemas/*.schema.json` çš„æœ‰æ•ˆæ€§
- ç¡®ä¿ Edge Function å®ç°ä¸ OpenAPI è§„èŒƒä¸€è‡´

**æ­¥éª¤3ï¼šæ›´æ–°æ£€æŸ¥æ¸…å•**
```bash
# åœ¨ Cursor ä¸­ä½¿ç”¨å‘½ä»¤ï¼š
/speckit.checklist
```
- æ ¹æ®å®ç°çŠ¶æ€æ›´æ–° `checklists/requirements.md`
- æ ‡è®°å·²å®Œæˆçš„æ£€æŸ¥é¡¹
- è¯†åˆ«ä»éœ€è¦å…³æ³¨çš„é—®é¢˜

**æ­¥éª¤4ï¼šé‡æ–°è§„åˆ’ï¼ˆå¦‚éœ€è¦ï¼‰**
```bash
# å¦‚æœå®ç°è¿‡ç¨‹ä¸­æœ‰é‡å¤§å˜æ›´ï¼Œå¯ä½¿ç”¨ï¼š
/speckit.plan
```
- åŸºäºå½“å‰å®ç°çŠ¶æ€æ›´æ–°æŠ€æœ¯æ ˆå’Œæ¶æ„å†³ç­–
- è°ƒæ•´é¡¹ç›®ç»“æ„å’Œä¾èµ–å…³ç³»

**æ­¥éª¤5ï¼šé‡æ–°ç”Ÿæˆä»»åŠ¡ï¼ˆå¦‚éœ€è¦ï¼‰**
```bash
# å¦‚æœéœ€è¦è¡¥å……æ–°ä»»åŠ¡æˆ–è°ƒæ•´ä»»åŠ¡åˆ—è¡¨ï¼š
/speckit.tasks
```
- æ ¹æ®å®é™…å®ç°çŠ¶æ€ç”Ÿæˆæˆ–æ›´æ–°ä»»åŠ¡åˆ—è¡¨
- æ ‡è®°å·²å®Œæˆçš„ä»»åŠ¡

**æç¤ºè¯æ¨¡æ¿ï¼ˆç”¨äºæ›´æ–°æ–‡æ¡£ï¼‰ï¼š**

```
è¯·ä½¿ç”¨ spec-kit å‘½ä»¤å¯¹é¡¹ç›®æ–‡æ¡£è¿›è¡Œæ•´ä½“æ›´æ–°ï¼š
1. ä½¿ç”¨ /speckit.analyze åˆ†æå½“å‰æ–‡æ¡£ä¸€è‡´æ€§
2. æ£€æŸ¥ contracts/ ç›®å½•ä¸‹çš„è§„èŒƒæ–‡ä»¶æ˜¯å¦ä¸å®ç°ä¸€è‡´
3. æ›´æ–° checklists/requirements.md ä¸­çš„å®ŒæˆçŠ¶æ€
4. å¦‚å®ç°æœ‰é‡å¤§å˜æ›´ï¼Œä½¿ç”¨ /speckit.plan æ›´æ–°æŠ€æœ¯è§„åˆ’
5. æ ¹æ®åˆ†æç»“æœï¼Œæä¾›æ–‡æ¡£æ”¹è¿›å»ºè®®
```

**æ³¨æ„äº‹é¡¹ï¼š**
- æ‰€æœ‰ spec-kit å‘½ä»¤åº”åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
- ç¡®ä¿å·²å­˜åœ¨ safety ç›®å½•ç»“æ„ï¼ˆspecs/001-ai-chart-mvp/ï¼‰
- ä¿®æ”¹æ–‡æ¡£å‰è¯·å…ˆè¿›è¡Œåˆ†æï¼Œç¡®ä¿ç†è§£å˜æ›´å½±å“

é™„ï¼šæœ€å°ç¤ºä¾‹ï¼ˆç‰‡æ®µï¼‰

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/chartConfig.schema.json",
  "title": "EChartsConfig",
  "type": "object",
  "properties": {
    "title": { "type": "object", "properties": { "text": { "type": "string" } }, "required": ["text"] },
    "series": { "type": "array", "items": { "type": "object", "properties": { "type": { "type": "string" } }, "required": ["type"] } }
  },
  "required": ["series"]
}
```

```yaml
openapi: 3.0.3
info:
  title: AI Chart API
  version: 1.0.0
paths:
  /functions/v1/generate_chart:
    post:
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './schemas/userData.schema.json'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './schemas/chartConfig.schema.json'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
```

åäºŒã€é…ç½®ä¸ç¯å¢ƒå˜é‡

1. ç¯å¢ƒåŒºåˆ†
- dev / staging / prod ä¸‰å¥—å˜é‡ï¼Œä¸¥ç¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥

2. å˜é‡æ¸…å•ï¼ˆç¤ºä¾‹ï¼‰
- SUPABASE_URLã€SUPABASE_ANON_KEYã€SUPABASE_SERVICE_ROLEï¼ˆä»… Edge ä½¿ç”¨ï¼‰
- EDGE_GENERATE_CHART_URL
- DASHSCOPE_API_KEYã€DASHSCOPE_API_BASEï¼ˆå¯é€‰ï¼Œé»˜è®¤å…¼å®¹ç«¯ç‚¹ï¼‰ã€QWEN_MODEL
- SENTRY_DSNï¼ˆå¯é€‰ï¼‰

3. é¸¿è’™ç«¯å®‰å…¨å­˜å‚¨
- ä½¿ç”¨ `AppScope`/ç³»ç»Ÿå®‰å…¨èƒ½åŠ›å­˜æ”¾å¯å…¬å¼€çš„ anon keyï¼›æœåŠ¡ç«¯å¯†é’¥ä»…åœ¨ Edge Function ä¾§

4. é…ç½®ç®¡ç†
- æœ¬åœ°ï¼š`.env.local`ï¼ˆä¸å…¥åº“ï¼‰+ `.env.example`
- CIï¼šä½¿ç”¨å¯†é’¥ä»“åº“æ³¨å…¥ï¼›æ„å»ºäº§ç‰©å†…ä»…åŒ…å«å¿…è¦å…¬å¼€é…ç½®

åä¸‰ã€å®‰å…¨ä¸åˆè§„

1. é‰´æƒä¸ä¼šè¯
- å…¨é‡ä¾èµ– Supabase Authï¼›å‰ç«¯ä»…æŒæœ‰çŸ­æœŸ tokenï¼ŒæŒ‰éœ€åˆ·æ–°

2. è¡Œçº§è®¿é—®æ§åˆ¶ï¼ˆRLSï¼‰
- å¯¹ `charts` è¡¨å¯ç”¨ RLSï¼Œç­–ç•¥ç¤ºä¾‹ï¼š

```sql
alter table charts enable row level security;
create policy charts_select_own on charts for select
  using (auth.uid() = user_id);
create policy charts_insert_own on charts for insert
  with check (auth.uid() = user_id);
```

3. Storage Bucket ç­–ç•¥
- `datasets` ä»…å…è®¸æ–‡ä»¶æ‹¥æœ‰è€…è¯»/å†™ï¼›é€šè¿‡ç­¾å URL åˆ†äº«

4. è¾“å…¥/è¾“å‡ºå‡€åŒ–
- å¯¹ç”¨æˆ·æ•°æ®ä¸æ¨¡å‹è¾“å‡ºè¿›è¡Œ Schema æ ¡éªŒä¸å¤§å°é™åˆ¶ï¼›æ‹’ç»è¶…é•¿/äºŒè¿›åˆ¶æ··å…¥

5. é€Ÿç‡é™åˆ¶ä¸é˜²æ»¥ç”¨
- åœ¨ Edge Function å±‚åŸºäºç”¨æˆ· ID/IP åšé€Ÿç‡é™åˆ¶ï¼ˆå¦‚ `60 req/min`ï¼‰

6. å®¡è®¡ä¸ç•™ç—•
- å…³é”®æ“ä½œï¼ˆç”Ÿæˆã€å¯¼å‡ºã€åˆ†äº«ï¼‰å†™å®¡è®¡è¡¨ï¼›ä¸æ—¥å¿— Trace ID å…³è”

åå››ã€æ€§èƒ½ä¸ç¦»çº¿èƒ½åŠ›

1. ä¸Šä¼ ä¸æ¸²æŸ“ä¼˜åŒ–
- å¤§æ–‡ä»¶åˆ†ç‰‡/æ–­ç‚¹ç»­ä¼ ï¼›CSV è§£æåœ¨ Workerï¼ˆæˆ– Edge é¢„å¤„ç†ï¼‰
- ECharts WebView é¢„åŠ è½½ä¸èµ„æºæœ¬åœ°åŒ–ï¼›æŒ‰éœ€æ‡’åŠ è½½ç»„ä»¶

2. ç¼“å­˜ç­–ç•¥
- å›¾è¡¨ JSON ä¸ç¼©ç•¥å›¾æœ¬åœ°ç¼“å­˜ï¼›è¾¹ç¼˜ç¼“å­˜ Edge å“åº”ï¼ˆå‘½ä¸­åç›´æ¥è¿”å›ï¼‰

3. ç¦»çº¿æ”¯æŒï¼ˆå¯é€‰ï¼‰
- æœ€è¿‘ N ä¸ªå›¾è¡¨ä¸æ•°æ®å¯ç¦»çº¿æµè§ˆï¼›åœ¨çº¿æ—¶å¢é‡åŒæ­¥

åäº”ã€å¯è§‚æµ‹æ€§ä¸é”™è¯¯å¤„ç†

1. æ—¥å¿—ä¸è¿½è¸ª
- å‰ç«¯ï¼šç»“æ„åŒ–æ—¥å¿— + ä¼šè¯/ç”¨æˆ· ID + requestId
- Edgeï¼šç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼Œè®°å½•æ¨¡å‹è€—æ—¶/ä»¤ç‰Œæ•°/å¤±è´¥ç‡

2. æŒ‡æ ‡
- ç”ŸæˆæˆåŠŸç‡ã€P95 è€—æ—¶ã€å¹³å‡ token ä½¿ç”¨é‡ã€å¯¼å‡ºè½¬åŒ–ç‡

3. é”™è¯¯å¤„ç†
- ç»Ÿä¸€é”™è¯¯ç ä¸ç”¨æˆ·æç¤ºæ–‡æ¡ˆï¼›é‡è¯•ä¸é™çº§ï¼ˆåˆ‡æ¢ç®€å•å›¾è¡¨æ¨¡æ¿ï¼‰

åå…­ã€æµ‹è¯•ä¸è´¨é‡ä¿éšœ

1. å•å…ƒæµ‹è¯•
- ArkTS ç»„ä»¶ä¸å·¥å…·ï¼›Edge å‡½æ•°é€»è¾‘ä¸ Schema å®ˆå«

2. é›†æˆ/åˆçº¦æµ‹è¯•
- ä¾æ® OpenAPI/Schema çš„ contract testsï¼Œæ ¡éªŒå…¥å‚å‡ºå‚ä¸€è‡´æ€§

3. ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
- å…³é”®è·¯å¾„ï¼šç™»å½•â†’ä¸Šä¼ â†’ç”Ÿæˆâ†’æ¸²æŸ“â†’å¯¼å‡ºâ†’ä¿å­˜

åä¸ƒã€CI/CD ä¸å‘å¸ƒ

1. CI æ­¥éª¤
- Lint/Format â†’ è§„èŒƒæ ¡éªŒï¼ˆspec-kitï¼‰â†’ å•æµ‹/åˆçº¦æµ‹ â†’ æ„å»º

2. éƒ¨ç½²
- ä½¿ç”¨ Supabase CLI éƒ¨ç½² Edge Functions ä¸æ•°æ®åº“è¿ç§»
- æ„å»ºé¸¿è’™åº”ç”¨åŒ…ï¼›ç­¾åä¸æ¸ é“åˆ†å‘

3. ç‰ˆæœ¬ç­–ç•¥
- åç«¯ä¸å‰ç«¯ä½¿ç”¨ semverï¼›OpenAPI å˜æ›´èµ° `x-version` æ ‡æ³¨

åå…«ã€é‡Œç¨‹ç¢‘ä¸éªŒæ”¶

é‡Œç¨‹ç¢‘ M1ï¼ˆç¬¬1-2å‘¨ï¼‰ï¼šé¡¹ç›®éª¨æ¶ã€ECharts WebViewã€æ–‡ä»¶é€‰æ‹©ä¸åŸºç¡€æ¸²æŸ“
- éªŒæ”¶ï¼šå¯åŠ è½½é™æ€é…ç½®æ¸²æŸ“æŠ˜çº¿å›¾ï¼Œå®Œæˆ spec-kit åˆç‰ˆä¸æ ¡éªŒ

é‡Œç¨‹ç¢‘ M2ï¼ˆç¬¬3-4å‘¨ï¼‰ï¼šæ¥å…¥ Supabase Auth/Storage/DBï¼Œå®Œæˆä¸Šä¼ ä¸è®°å½•
- éªŒæ”¶ï¼šç™»å½•å¯ç”¨ã€ä¸Šä¼ å¯ç”¨ã€ç”Ÿæˆè®°å½•å¯æŸ¥è¯¢

é‡Œç¨‹ç¢‘ M3ï¼ˆç¬¬5-6å‘¨ï¼‰ï¼šEdge Function AI è°ƒç”¨ã€Schema æ ¡éªŒä¸é€Ÿç‡é™åˆ¶
- éªŒæ”¶ï¼šå¯å¯¹ä¸­ç­‰è§„æ¨¡æ•°æ®ç”Ÿæˆå›¾è¡¨ï¼ŒRLS ç”Ÿæ•ˆï¼Œé€Ÿç‡é™åˆ¶ç”Ÿæ•ˆ

é‡Œç¨‹ç¢‘ M4ï¼ˆç¬¬7-8å‘¨ï¼‰ï¼šå¯¼å‡ºã€å†å²é¡µã€è§‚æµ‹å‘Šè­¦ä¸ç¨³å®šæ€§ä¼˜åŒ–
- éªŒæ”¶ï¼šPNG/PDF å¯¼å‡ºç¨³å®šï¼›SLO è¾¾æˆï¼ˆæˆåŠŸç‡â‰¥99%ï¼ŒP95â‰¤3sï¼‰

åä¹ã€é¢„ç®—ä¸æˆæœ¬ï¼ˆä¼°ç®—ï¼‰

- Supabaseï¼šå…è´¹å±‚èµ·æ­¥ï¼›æŒ‰å­˜å‚¨/å¸¦å®½/å‡½æ•°è°ƒç”¨é‡æ‰©å±•
- AI æ¨¡å‹ï¼šä»¥ 1K æ¬¡/æœˆã€æ¯æ¬¡ 1K tokens ä¼°ç®—ï¼Œæˆæœ¬éšæ¨¡å‹ä¸ä¸Šä¸‹æ–‡é•¿åº¦æ³¢åŠ¨
- ç›‘æ§ï¼šSentry/Log æœåŠ¡æŒ‰é‡è®¡è´¹

äºŒåã€é£é™©ä¸åº”å¯¹

- æ¨¡å‹è¾“å‡ºä¸ç¨³å®šï¼šåŠ å…¥æ¨¡æ¿åŒ–ä¸åå¤„ç†æ ¡éªŒï¼Œå¤±è´¥å›é€€åˆ°æ¨èå›¾è¡¨ç±»å‹
- æ•°æ®éšç§åˆè§„ï¼šä»…ä¼ æœ€å°å¿…è¦æ•°æ®åˆ°æ¨¡å‹ï¼›æä¾›è„±æ•é€‰é¡¹
- WebView æ¸²æŸ“æ€§èƒ½ï¼šé•¿åˆ—è¡¨/è¶…å¤§æ•°æ®é¢„èšåˆï¼›é™åˆ¶ç‚¹æ•°/æŠ½æ ·å±•ç¤º
- å¤šæ¨¡å‹/åŒºåŸŸå¯ç”¨æ€§ï¼šæ”¯æŒæ¨¡å‹/åœ°åŒºåˆ‡æ¢ï¼›ç½‘ç»œå¼‚å¸¸é‡è¯•ä¸é™çº§

é™„å½•ï¼šä¸ Edge Function çš„è¿è¡Œæ—¶æ ¡éªŒç¤ºä¾‹ï¼ˆDeno + Ajv ç‰‡æ®µï¼‰

```ts
import { Ajv } from "https://esm.sh/ajv";
import userDataSchema from "./schemas/userData.schema.json" assert { type: "json" };
import chartConfigSchema from "./schemas/chartConfig.schema.json" assert { type: "json" };

const ajv = new Ajv({ allErrors: true });
const validateIn = ajv.compile(userDataSchema);
const validateOut = ajv.compile(chartConfigSchema);

export default Deno.serve(async (req) => {
  const body = await req.json();
  if (!validateIn(body)) return new Response(JSON.stringify({ code: "INVALID_INPUT", errors: validateIn.errors }), { status: 400 });
  // ... è°ƒç”¨æ¨¡å‹ ...
  const result = {/* æ¨¡å‹è¿”å› */};
  if (!validateOut(result)) return new Response(JSON.stringify({ code: "INVALID_MODEL_OUTPUT" }), { status: 502 });
  return new Response(JSON.stringify(result), { headers: { "Content-Type": "application/json" } });
});
```

é™„å½•ï¼šé€šä¹‰åƒé—®ï¼ˆDashScopeï¼‰Edge Function è°ƒç”¨ç¤ºä¾‹ï¼ˆOpenAI å…¼å®¹æ¥å£ï¼Œé¡¹ç›®é»˜è®¤æ¨¡å‹ï¼‰

ç¯å¢ƒå˜é‡ï¼š
- DASHSCOPE_API_KEYï¼ˆå¿…å¡«ï¼‰
- DASHSCOPE_API_BASEï¼ˆå¯é€‰ï¼Œé»˜è®¤ `https://dashscope.aliyuncs.com/compatible-mode/v1`ï¼‰

è¯´æ˜ï¼šä½¿ç”¨ OpenAI å…¼å®¹çš„ chat completions æ¥å£ï¼Œ`response_format` è®¾ä¸º `json_object`ï¼Œå¹¶ç»“åˆä¸Šæ–‡ Schema è¿›è¡ŒäºŒæ¬¡æ ¡éªŒï¼›æ¨¡å‹å»ºè®® `qwen-plus`ï¼ˆæ€§ä»·æ¯”ï¼‰æˆ– `qwen-max`ï¼ˆæ•ˆæœä¼˜å…ˆï¼‰ã€‚

```ts
// /supabase/functions/generate_chart_qwen.ts
import { Ajv } from "https://esm.sh/ajv";
import userDataSchema from "./schemas/userData.schema.json" assert { type: "json" };
import chartConfigSchema from "./schemas/chartConfig.schema.json" assert { type: "json" };

const ajv = new Ajv({ allErrors: true });
const validateIn = ajv.compile(userDataSchema);
const validateOut = ajv.compile(chartConfigSchema);

const API_BASE = Deno.env.get("DASHSCOPE_API_BASE")?.replace(/\/$/, "") ||
  "https://dashscope.aliyuncs.com/compatible-mode/v1";
const API_KEY = Deno.env.get("DASHSCOPE_API_KEY");
const MODEL = Deno.env.get("QWEN_MODEL") || "qwen-plus";

if (!API_KEY) {
  console.error("DASHSCOPE_API_KEY is missing");
}

const systemPrompt = `ä½ æ˜¯æ•°æ®å¯è§†åŒ–ä¸“å®¶ã€‚ä¾æ®ç”¨æˆ·æä¾›çš„æ•°æ®ï¼ˆå¯èƒ½æ˜¯ CSV è§£æåçš„å¯¹è±¡ã€æˆ–ç»“æ„åŒ– JSONï¼‰ï¼Œ
äº§å‡ºä¸¥æ ¼ç¬¦åˆ ECharts Option çš„ JSONï¼›ä¸è¦è¾“å‡ºä»»ä½•é JSON æ–‡æœ¬ã€‚æŒ‰ä»¥ä¸‹è¦æ±‚ï¼š
1) è‡ªåŠ¨é€‰æ‹©åˆé€‚å›¾è¡¨ï¼ˆå¦‚ bar/line/pie/scatterï¼‰ï¼Œ
2) ç”Ÿæˆæœ€å°å¿…è¦å­—æ®µï¼ˆtitleã€legendã€tooltipã€xAxis/yAxisã€seriesã€dataset/optionï¼‰ï¼Œ
3) æ–‡æœ¬è¯·ä½¿ç”¨ç®€ä½“ä¸­æ–‡ï¼Œ
4) è‹¥è¾“å…¥ä¿¡æ¯ä¸è¶³ï¼Œåˆç†å‡è®¾å¹¶ç»™å‡ºå¯æ¸²æŸ“çš„é…ç½®ã€‚`;

async function callQwen(messages: Array<{ role: string; content: string }>, signal?: AbortSignal) {
  const body = {
    model: MODEL,
    temperature: 0,
    response_format: { type: "json_object" },
    messages,
  };
  const res = await fetch(`${API_BASE}/chat/completions`, {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${API_KEY}`,
      "Content-Type": "application/json",
    },
    body: JSON.stringify(body),
    signal,
  });
  if (!res.ok) {
    const text = await res.text();
    throw new Error(`DashScope error: ${res.status} ${text}`);
  }
  const data = await res.json();
  const content = data?.choices?.[0]?.message?.content;
  if (!content) throw new Error("Empty Qwen response");
  return content;
}

export default Deno.serve(async (req) => {
  const ctrl = new AbortController();
  const timeout = setTimeout(() => ctrl.abort("timeout"), 3000);
  try {
    const body = await req.json();
    if (!validateIn(body)) {
      return new Response(JSON.stringify({ code: "INVALID_INPUT", errors: validateIn.errors }), { status: 400 });
    }
    const userMsg = typeof body === "string" ? body : JSON.stringify(body);
    const content = await callQwen([
      { role: "system", content: systemPrompt },
      { role: "user", content: `è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®è¿”å› ECharts é…ç½®çš„ JSONï¼š\n${userMsg}` },
    ], ctrl.signal);

    // äºŒæ¬¡æ ¡éªŒä¸é™çº§
    let json: unknown;
    try { json = JSON.parse(content); } catch (_) {
      return new Response(JSON.stringify({ code: "INVALID_JSON_OUTPUT" }), { status: 502 });
    }
    if (!validateOut(json)) {
      // ç®€å•å›é€€æ¨¡æ¿ï¼ˆç¤ºä¾‹ï¼šæŠ˜çº¿å›¾ï¼‰
      const fallback = {
        title: { text: "AI æ¨èå›¾è¡¨" },
        tooltip: {},
        xAxis: { type: "category" },
        yAxis: { type: "value" },
        series: [{ type: "line", data: [] }],
      };
      return new Response(JSON.stringify(fallback), { headers: { "Content-Type": "application/json" } });
    }
    return new Response(JSON.stringify(json), { headers: { "Content-Type": "application/json" } });
  } catch (e) {
    const status = e?.message?.includes("timeout") ? 504 : 500;
    return new Response(JSON.stringify({ code: "QWEN_ERROR", message: String(e?.message || e) }), { status });
  } finally {
    clearTimeout(timeout);
  }
});
```

**å˜æ›´æ—¥å¿—ï¼ˆ2025-10-29ï¼‰**

- ä¿®å¤æ„å»ºé”™è¯¯ï¼šæ ¹æ®é¸¿è’™ Lite-wearableï¼ˆAPI â‰¥ 9 ä»…æ”¯æŒ JSï¼‰çš„é™åˆ¶ï¼Œè¿›ä¸€æ­¥å°† `deviceTypes` æ”¶æ•›ä¸ºä»… `phone`ï¼Œå½»åº•è§„é¿å¯ç©¿æˆ´/éæ‰‹æœºç›®æ ‡å¯¼è‡´çš„ ETS æ„å»ºå¤±è´¥ï¼ˆ`00303052 Configuration Error`ï¼‰ã€‚
- æ–‡æ¡£å®Œå–„ï¼šæ›´æ–° `specs/001-ai-chart-mvp/` ä¸‹ `plan.md/spec.md/data-model.md/research.md/tasks.md/checklists/requirements.md` ä»¥è¦†ç›–å¤šè®¾å¤‡èŒƒå›´ã€é£é™©ã€æµ‹è¯•çŸ©é˜µã€å®Œæˆå®šä¹‰ä¸é—¨ç¦
- App ä¼˜åŒ–ï¼š
  - `Index.ets`ï¼šå¤–å±‚å¢åŠ  `Scroll`ï¼Œè¾“å…¥åŒºé«˜åº¦æ”¹ä¸ºè‡ªé€‚åº”ï¼ˆ40%ï¼‰ï¼Œé¿å…å°å±æº¢å‡º
  - `ChartPage.ets`ï¼šå¤–å±‚å¢åŠ  `Scroll`ï¼Œå†…å®¹è‡ªé€‚åº”ï¼Œæå‡å¤§å±ä¸å¯ç©¿æˆ´å¯è¯»æ€§
- é£é™©ä¸é™çº§ï¼šåœ¨ tv/car/smartVision ä¸Šæ–‡ä»¶ä¸Šä¼ å…¥å£é¢„ç•™é™çº§ç­–ç•¥ï¼ˆæ–‡æœ¬è¾“å…¥/å†å²å¤ç°ï¼‰ï¼Œå¯¼å‡ºåœ¨å—é™è®¾å¤‡ä»¥ JSON æ›¿ä»£
- åç»­å¾…åŠï¼šWebView/ECharts æ¡¥æ¥æ¥å…¥ã€æ–‡ä»¶ API å®è£…ã€Supabase SDK åˆå§‹åŒ–ä¸é‰´æƒé…ç½®

- æ–°å¢ï¼šå‰ç«¯è¿è¡Œæ—¶é…ç½®æ³¨å…¥ä¸é‰´æƒå¤´ä¿®å¤ï¼Œæ¶ˆé™¤â€œMissing authorization headerâ€é—®é¢˜ï¼ˆéœ€è¦æœ¬åœ°å¡«å…¥ anon keyï¼‰ã€‚

**å˜æ›´æ—¥å¿—ï¼ˆ2025-10-29Â·è¡¥å……ï¼‰**

- Edge Function é…ç½®ä¿®å¤ï¼šç§»é™¤é€šè¿‡ CLI flags ä¼ é€’ import_map/è£…é¥°å™¨çš„æ—§æ–¹å¼ï¼Œç»Ÿä¸€æ”¹ä¸ºå‡½æ•°ç›®å½• `deno.json` ç®¡ç†ï¼›å·²åœ¨ `supabase/functions/generate_chart_qwen/deno.json` å¯ç”¨ `"experimentalDecorators": true`ï¼Œé¿å…éƒ¨ç½²è­¦å‘Šï¼Œå…¼å®¹åç»­ Deno/Supabase CLI ç‰ˆæœ¬ã€‚
- å»ºè®®å‡çº§ Supabase CLI è‡³æœ€æ–°ç‰ˆæœ¬ä»¥è·å¾—æ›´ç¨³å®šçš„ Deno 2 æ”¯æŒï¼ˆæœ¬åœ°æ‰§è¡Œï¼š`brew upgrade supabase/tap/supabase` æˆ– `supabase update`ï¼‰ã€‚

**å˜æ›´æ—¥å¿—ï¼ˆ2025-10-29Â·å†æ¬¡è¡¥å……ï¼‰**

- ç§»é™¤ `experimentalDecorators`ï¼šç”±äº Deno/TS æ–°ç‰ˆæç¤ºè¯¥é€‰é¡¹å·²å¼ƒç”¨ä¸”æœ¬å‡½æ•°æœªä½¿ç”¨è£…é¥°å™¨ï¼Œæ•…ä» `supabase/functions/generate_chart_qwen/deno.json` ä¸­åˆ é™¤è¯¥é…ç½®ï¼Œä»¥æ¶ˆé™¤éƒ¨ç½²æ—¶çš„å¼ƒç”¨è­¦å‘Šã€‚
- å…³äº"Specifying import_map/decorator through flags is no longer supported"ï¼šè¯¥æç¤ºæ¥è‡ª CLI/è¿è¡Œæ—¶å†…éƒ¨é€»è¾‘ï¼Œå½“å‰æˆ‘ä»¬å·²ä½¿ç”¨ `deno.json` æ­£ç¡®ç®¡ç† importsï¼Œæ— éœ€é¢å¤–æ“ä½œï¼Œæç¤ºå¯å¿½ç•¥ã€‚

**å˜æ›´æ—¥å¿—ï¼ˆ2025-01-28Â·å¤šè®¾å¤‡é€‚é…å®Œæˆï¼‰**

- âœ… **å¤šè®¾å¤‡é€‚é…åŠŸèƒ½å·²å®Œæˆ**ï¼š
  - æ–°å¢ `entry/src/main/ets/utils/deviceAdapter.ets`ï¼šè®¾å¤‡æ£€æµ‹å’Œé€‚é…å·¥å…·ç±»
    - æ”¯æŒæ£€æµ‹è®¾å¤‡ç±»å‹ï¼ˆphone/tablet/2in1/tv/wearable/car/smartVisionï¼‰
    - æä¾›å“åº”å¼å¸ƒå±€é…ç½®ï¼ˆå­—å·ã€é—´è·ã€å†…è¾¹è·ã€æ …æ ¼åˆ—æ•°ï¼‰
    - æ£€æµ‹è®¾å¤‡èƒ½åŠ›ï¼ˆæ–‡ä»¶é€‰æ‹©å™¨ã€å›¾ç‰‡å¯¼å‡ºã€PDFå¯¼å‡ºã€ç„¦ç‚¹å¯¼èˆªç­‰ï¼‰
    - æä¾›é™çº§æç¤ºæ–‡æ¡ˆ
    - æ”¯æŒçª—å£å¤§å°å˜åŒ–ç›‘å¬ï¼ˆç”¨äº2in1/å¤§å±é€‚é…ï¼‰
  - æ›´æ–° `entry/src/main/ets/pages/Index.ets`ï¼š
    - æ·»åŠ è®¾å¤‡é€‚é…å¸ƒå±€é…ç½®
    - å®ç°æ–‡ä»¶ä¸Šä¼ é™çº§ç­–ç•¥ï¼ˆTV/è½¦æœº/å¯ç©¿æˆ´è®¾å¤‡éšè—ä¸Šä¼ æŒ‰é’®ï¼‰
    - æ·»åŠ ç„¦ç‚¹å¯¼èˆªæ”¯æŒ
    - ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼ˆ2in1/å¤§å±ï¼‰
  - æ›´æ–° `entry/src/main/ets/pages/HistoryPage.ets`ï¼š
    - æ·»åŠ è®¾å¤‡é€‚é…å¸ƒå±€é…ç½®
    - æ·»åŠ ç„¦ç‚¹å¯¼èˆªæ”¯æŒ
    - ä¼˜åŒ–å¯ç©¿æˆ´è®¾å¤‡æ˜¾ç¤º
  - æ›´æ–° `entry/src/main/ets/pages/ChartPage.ets`ï¼š
    - æ·»åŠ è®¾å¤‡é€‚é…å¸ƒå±€é…ç½®
    - å®ç°å¯¼å‡ºèƒ½åŠ›é™çº§ï¼ˆPNG/PDFæ ¹æ®è®¾å¤‡èƒ½åŠ›æ˜¾ç¤º/éšè—ï¼‰
    - æ·»åŠ ç„¦ç‚¹å¯¼èˆªæ”¯æŒ
    - ä¼˜åŒ–å¯ç©¿æˆ´è®¾å¤‡æ˜¾ç¤º
- ğŸ“ æ›´æ–° `æœªå®ŒæˆåŠŸèƒ½åˆ†æ.md`ï¼šæ ‡è®°å¤šè®¾å¤‡é€‚é…ä¸ºå·²å®Œæˆ
- ğŸ“ æ›´æ–°å®Œæˆåº¦ç»Ÿè®¡ï¼šæ€»ä½“å®Œæˆåº¦ä»85%æå‡è‡³92%

**å˜æ›´æ—¥å¿—ï¼ˆ2025-01-28Â·æ ¸å¿ƒåŠŸèƒ½ä¿®å¤ï¼‰**

- âœ… **ä¿®å¤æ ¸å¿ƒåŠŸèƒ½æ— æ³•å®ç°çš„é—®é¢˜**ï¼š
  - ä¿®å¤ `ChartPage.ets` ä¸­ WebView å’Œ ECharts çš„æ¡¥æ¥é—®é¢˜ï¼š
    - æ·»åŠ é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š5æ¬¡ï¼Œæ¯æ¬¡é—´éš”200msï¼‰ï¼Œç¡®ä¿ `chartAPI` åœ¨è°ƒç”¨å‰å·²åˆå§‹åŒ–
    - ä¼˜åŒ– `applyChartConfig()` æ–¹æ³•ï¼Œæ£€æŸ¥ `chartAPI` æ˜¯å¦å‡†å¤‡å¥½å†è°ƒç”¨
    - æ·»åŠ  WebView console æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•
    - åœ¨ `onPageEnd` å›è°ƒä¸­å»¶è¿Ÿ300mså†è°ƒç”¨ `applyChartConfig()`ï¼Œç¡®ä¿ JavaScript ç¯å¢ƒå®Œå…¨åˆå§‹åŒ–
  - ä¿®å¤ `Index.ets` é¡µé¢çŠ¶æ€ä¼ é€’é—®é¢˜ï¼š
    - ä¼˜åŒ–å›¾è¡¨ç”ŸæˆæˆåŠŸåçš„çŠ¶æ€ä¿å­˜å’Œè·³è½¬é€»è¾‘
    - å‡å°‘è·³è½¬å»¶è¿Ÿæ—¶é—´ï¼ˆä»1000msæ”¹ä¸º500msï¼‰ï¼Œæé«˜å“åº”é€Ÿåº¦
    - æ·»åŠ æ›´è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•
  - ä¿®å¤åŒ¿åç”¨æˆ·ä½¿ç”¨é—®é¢˜ï¼š
    - æ›´æ–° `supabaseClient.ets` ä¸­çš„ `saveChart()` æ–¹æ³•ï¼ŒåŒ¿åç”¨æˆ·è·³è¿‡æ•°æ®åº“ä¿å­˜ï¼ˆä»…æœ¬åœ°ä½¿ç”¨ï¼‰
    - ç¡®ä¿æœªç™»å½•ç”¨æˆ·ä¹Ÿèƒ½æ­£å¸¸ç”Ÿæˆå’ŒæŸ¥çœ‹å›¾è¡¨
  - ä¼˜åŒ– WebView åˆå§‹åŒ–æ—¶åºï¼š
    - åœ¨ `initWebView()` ä¸­æ£€æŸ¥æ˜¯å¦æœ‰å¾…æ¸²æŸ“çš„å›¾è¡¨é…ç½®
    - å¦‚æœæ²¡æœ‰é…ç½®ï¼Œæ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
    - ç¡®ä¿ `isLoading` çŠ¶æ€åœ¨å›¾è¡¨é…ç½®åº”ç”¨æˆåŠŸåæ­£ç¡®æ›´æ–°

**å˜æ›´æ—¥å¿—ï¼ˆ2025-01-28Â·åŠŸèƒ½æ•´åˆï¼‰**

- âœ… **æ–°å¢ Pomodoroï¼ˆç•ªèŒ„é’Ÿï¼‰ä¸“æ³¨ç®¡ç†åŠŸèƒ½**ï¼š
  - æ–°å¢ `entry/src/main/ets/pages/FocusPage.ets`ï¼šPomodoroä¸»ç•Œé¢
    - æ˜¾ç¤º25åˆ†é’Ÿå€’è®¡æ—¶å™¨ï¼ˆåœ†å½¢è¿›åº¦æŒ‡ç¤ºå™¨ï¼‰
    - ä»Šæ—¥è¿›åº¦å¡ç‰‡ï¼ˆå®Œæˆ/ç›®æ ‡ç•ªèŒ„é’Ÿæ•°é‡ï¼‰
    - ä»»åŠ¡åˆ—è¡¨ï¼ˆåˆ›å»ºã€æ›´æ–°ã€å®Œæˆä»»åŠ¡ï¼‰
    - æ·»åŠ æ–°ä»»åŠ¡åŠŸèƒ½
  - æ–°å¢ `entry/src/main/ets/pages/FocusTimerPage.ets`ï¼šè®¡æ—¶å™¨é¡µé¢
    - å€’è®¡æ—¶æ˜¾ç¤ºï¼ˆ25åˆ†é’Ÿï¼‰
    - æš‚åœ/ç»§ç»­åŠŸèƒ½
    - æ”¾å¼ƒåŠŸèƒ½
    - èƒŒæ™¯éŸ³é€‰æ‹©ï¼ˆé›¨å£°ã€é£å£°ã€å’–å•¡å…ï¼‰
    - å½“å‰ä»»åŠ¡ä¿¡æ¯æ˜¾ç¤º
  - æ–°å¢ `entry/src/main/ets/pages/ProgressPage.ets`ï¼šè¿›åº¦ç»Ÿè®¡é¡µé¢
    - æ—¶é—´æ®µé€‰æ‹©ï¼ˆå‘¨/æœˆ/å¹´ï¼‰
    - æ€»ä¸“æ³¨æ—¶é—´ç»Ÿè®¡
    - ä¸“æ³¨è¶‹åŠ¿å›¾è¡¨ï¼ˆç®€åŒ–ç‰ˆï¼‰
    - ä»»åŠ¡åˆ†å¸ƒå›¾è¡¨ï¼ˆé¥¼å›¾ç®€åŒ–ç‰ˆï¼‰
    - å®Œæˆæœ€å¤šçš„ä»»åŠ¡åˆ—è¡¨
  - æ–°å¢ `entry/src/main/ets/utils/pomodoroService.ets`ï¼šPomodoroæœåŠ¡
    - ä»»åŠ¡ç®¡ç†ï¼ˆæ·»åŠ ã€æ›´æ–°ã€åˆ é™¤ã€æŸ¥è¯¢ï¼‰
    - ä¼šè¯ç®¡ç†ï¼ˆå¼€å§‹ã€å®Œæˆã€æ”¾å¼ƒï¼‰
    - æ•°æ®ç»Ÿè®¡ï¼ˆä»Šæ—¥è¿›åº¦ã€ä¸“æ³¨è¶‹åŠ¿ã€ä»»åŠ¡åˆ†å¸ƒã€Topä»»åŠ¡ï¼‰
    - æœ¬åœ°å­˜å‚¨ï¼ˆä½¿ç”¨ dataPreferences æŒä¹…åŒ–ï¼‰
  
- âœ… **æ–°å¢å¯åŠ¨é¡µåŠŸèƒ½**ï¼š
  - æ–°å¢ `entry/src/main/ets/pages/SplashPage.ets`ï¼šåº”ç”¨å¯åŠ¨é¡µ
    - LogoåŠ¨ç”»ï¼ˆä¸‰å±‚åœ†åœˆè®¾è®¡ï¼‰
    - åŠ è½½è¿›åº¦æ¡
    - è‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µï¼ˆåŠ è½½å®Œæˆåï¼‰

- âœ… **é¡µé¢è·¯ç”±æ›´æ–°**ï¼š
  - æ›´æ–° `entry/src/main/resources/base/profile/main_pages.json`ï¼š
    - æ·»åŠ  `SplashPage`ï¼ˆå¯åŠ¨é¡µï¼Œåº”è®¾ä¸ºé¦–é¡µï¼‰
    - æ·»åŠ  `FocusPage`ï¼ˆä¸“æ³¨ä¸»é¡µé¢ï¼‰
    - æ·»åŠ  `FocusTimerPage`ï¼ˆè®¡æ—¶å™¨é¡µé¢ï¼‰
    - æ·»åŠ  `ProgressPage`ï¼ˆè¿›åº¦ç»Ÿè®¡é¡µé¢ï¼‰

- âœ… **åŠŸèƒ½æ•´åˆè¯´æ˜**ï¼š
  - **æ•°æ®å¯è§†åŒ–åŠŸèƒ½**ï¼ˆåŸæœ‰ï¼‰ï¼š
    - æ•°æ®è¾“å…¥ â†’ AIåˆ†æ â†’ å›¾è¡¨ç”Ÿæˆ â†’ å¯¼å‡ºä¿å­˜
    - æ”¯æŒæ–‡ä»¶ä¸Šä¼ ã€æ‰‹åŠ¨è¾“å…¥ã€æ ·æœ¬æ•°æ®
    - äº‘ç«¯åŒæ­¥ï¼ˆSupabaseï¼‰
  - **ä¸“æ³¨ç®¡ç†åŠŸèƒ½**ï¼ˆæ–°å¢ï¼‰ï¼š
    - ä»»åŠ¡åˆ›å»º â†’ Pomodoroè®¡æ—¶ â†’ å®Œæˆç»Ÿè®¡ â†’ è¿›åº¦åˆ†æ
    - æœ¬åœ°å­˜å‚¨ï¼ˆdataPreferencesï¼‰
    - å¤šè®¾å¤‡é€‚é…æ”¯æŒ
  - **é€šç”¨åŠŸèƒ½**ï¼š
    - å¤šè®¾å¤‡é€‚é…ï¼ˆdeviceAdapterï¼‰
    - é”™è¯¯å¤„ç†ï¼ˆerrorHandlerï¼‰
    - å¼‚æ­¥ç®¡ç†ï¼ˆasyncManagerï¼‰
    - æ€§èƒ½ç›‘æ§ï¼ˆmetricsã€performanceMonitorï¼‰

- ğŸ“ **éœ€è¦æ•´åˆçš„éƒ¨åˆ†**ï¼š
  1. **å¯¼èˆªæ•´åˆ**ï¼š
     - åœ¨é¦–é¡µï¼ˆIndex.etsï¼‰æ·»åŠ å¯¼èˆªåˆ°ä¸“æ³¨é¡µé¢çš„å…¥å£
     - åœ¨ä¸“æ³¨é¡µé¢ï¼ˆFocusPage.etsï¼‰æ·»åŠ å¯¼èˆªåˆ°è¿›åº¦ç»Ÿè®¡é¡µé¢çš„å…¥å£
     - ç»Ÿä¸€å¯¼èˆªæ è®¾è®¡é£æ ¼
  2. **æ•°æ®åŒæ­¥**ï¼ˆå¯é€‰ï¼‰ï¼š
     - è€ƒè™‘å°† Pomodoro æ•°æ®åŒæ­¥åˆ° Supabaseï¼ˆå½“å‰ä¸ºæœ¬åœ°å­˜å‚¨ï¼‰
     - å®ç°è·¨è®¾å¤‡æ•°æ®åŒæ­¥
  3. **UIç»Ÿä¸€**ï¼š
     - ç»Ÿä¸€é¢œè‰²ä¸»é¢˜ï¼ˆå½“å‰ä¸¤æ¨¡å—ä½¿ç”¨ç›¸åŒä¸»é¢˜è‰² `#1A1A2E`ã€`#4A90E2`ï¼‰
     - ç»Ÿä¸€ç»„ä»¶æ ·å¼ï¼ˆæŒ‰é’®ã€å¡ç‰‡ã€è¿›åº¦æ¡ç­‰ï¼‰
  4. **åŠŸèƒ½å…³è”**ï¼ˆæœªæ¥æ‰©å±•ï¼‰ï¼š
     - åœ¨ä¸“æ³¨ç»Ÿè®¡ä¸­å¯è€ƒè™‘ä½¿ç”¨æ•°æ®å¯è§†åŒ–æ¨¡å—å±•ç¤ºå›¾è¡¨
     - å°†ä¸“æ³¨æ•°æ®ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆä¸“æ³¨è¶‹åŠ¿å›¾è¡¨

**æœåŠ¡ç«¯ï¼ˆEdge Functionï¼‰ç¯å¢ƒå˜é‡ä¸éƒ¨ç½²æ­¥éª¤ï¼ˆæ–°å¢ 2025-10-29ï¼‰**

1. å¿…å¡«ä¸å¯é€‰å˜é‡
   - å¿…å¡«ï¼š`DASHSCOPE_API_KEY`ï¼ˆé€šä¹‰åƒé—®å¯†é’¥ï¼Œä»…æœåŠ¡ç«¯æŒæœ‰ï¼‰
   - å¯é€‰ï¼š`QWEN_MODEL`ï¼ˆé»˜è®¤ `qwen-plus`ï¼‰
   - å¯é€‰ï¼š`DASHSCOPE_API_BASE`ï¼ˆé»˜è®¤ `https://dashscope.aliyuncs.com/compatible-mode/v1`ï¼‰

2. Dashboard é…ç½®
   - è·¯å¾„ï¼šProject â†’ Edge Functions â†’ `generate_chart_qwen` â†’ Settings/Configuration â†’ Environment variables
   - æ–°å¢ä»¥ä¸Šå˜é‡å¹¶ä¿å­˜ï¼Œç‚¹å‡» Redeploy é‡æ–°éƒ¨ç½²è¯¥å‡½æ•°

3. CLI é…ç½®ï¼ˆå¤‡é€‰ï¼‰
   - `supabase secrets set DASHSCOPE_API_KEY=******`
   - `supabase secrets set QWEN_MODEL=qwen-plus`
   - `supabase secrets set DASHSCOPE_API_BASE=https://dashscope.aliyuncs.com/compatible-mode/v1`
   - `supabase functions deploy generate_chart_qwen`

4. çº¿ä¸ŠéªŒè¯ï¼ˆä»¥ anon key è°ƒç”¨ï¼‰
   - ç¡®è®¤ 2xxï¼šè¡¨ç¤ºå¯†é’¥ç”Ÿæ•ˆï¼›è‹¥ 401 â†’ æ£€æŸ¥å‰ç«¯æ˜¯å¦æºå¸¦ `Authorization` ä¸ `apikey`
   - è‹¥ 500/504 â†’ æ£€æŸ¥ä¸Šè¿°ä¸‰é¡¹ç¯å¢ƒå˜é‡å¹¶ç¡®ä¿å·²é‡æ–°éƒ¨ç½²

åäº”-1ã€å˜é‡è¯»å–ä¸ä¸€é”®éªŒè¯ï¼ˆæ–°å¢ï¼‰

- å®¢æˆ·ç«¯å…¬å¼€é…ç½®å­˜æ”¾äº `entry/src/main/resources/rawfile/supabase.json`ï¼ˆä»… `supabaseUrl/anonKey`ï¼‰ã€‚
- ä¸ºé¿å…æ‰‹å·¥æ›¿æ¢å ä½ç¬¦ï¼Œæä¾›è„šæœ¬è‡ªåŠ¨è¯»å–å¹¶éªŒè¯ Edge Functionï¼š

```bash
bash ./commands/verify_edge.sh
```

- è¾“å‡ºä¸ºè°ƒç”¨ç»“æœã€‚è‹¥çŠ¶æ€ä¸º 200 ä¸”è¿”å›åŒ…å« `series` çš„ JSONï¼Œè¡¨ç¤ºï¼š
  - å®¢æˆ·ç«¯å·²æ­£ç¡®æºå¸¦ `Authorization/apikey`
  - æœåŠ¡å™¨ç«¯ `DASHSCOPE_API_KEY` ç­‰ç¯å¢ƒå˜é‡æœ‰æ•ˆ

å¸¸è§é”™è¯¯æ’æŸ¥ï¼š
- 401 Unauthorizedï¼š`anonKey` ç¼ºå¤±/é”™è¯¯ â†’ æ£€æŸ¥ `supabase.json` å†…å®¹ã€‚
- 404 Not Foundï¼šå‡½æ•°æœªéƒ¨ç½²æˆ–è·¯å¾„é”™è¯¯ â†’ ç¡®è®¤ `generate_chart_qwen` å·²éƒ¨ç½²ä¸” URL æ­£ç¡®ã€‚
- 500/504 ä¸”æ¶ˆæ¯å« "DASHSCOPE_API_KEY missing"ï¼šåœ¨ Dashboard çš„ Edge Function ç¯å¢ƒå˜é‡é‡Œè¡¥å…… `DASHSCOPE_API_KEY` å¹¶ Redeployï¼›æˆ–ä½¿ç”¨ `supabase secrets set --env-file ./supabase/functions/.env` åé‡æ–°éƒ¨ç½²ã€‚
