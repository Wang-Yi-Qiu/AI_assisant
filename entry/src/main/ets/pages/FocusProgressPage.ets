import router from '@ohos.router';

@Entry
@Component
struct FocusProgressPage {
  @State timerValue: number = 25 * 60; // 25åˆ†é’Ÿ
  @State isPaused: boolean = false;
  @State currentTask: string = "è®¾è®¡ä¸€ä¸ªæ–°çš„Logo"; // ç¤ºä¾‹ä»»åŠ¡

  private timerId: number = -1;

  aboutToAppear() {
    this.startTimer();
  }

  aboutToDisappear() {
    this.stopTimer();
  }

  // å¯åŠ¨è®¡æ—¶å™¨
  startTimer() {
    if (this.timerId === -1) {
      this.timerId = setInterval(() => {
        if (!this.isPaused && this.timerValue > 0) {
          this.timerValue--;
        } else if (this.timerValue === 0) {
          this.stopTimer();
          console.info('ç•ªèŒ„é’Ÿè®¡æ—¶ç»“æŸ');
        }
      }, 1000);
    }
  }

  // åœæ­¢è®¡æ—¶å™¨
  stopTimer() {
    if (this.timerId !== -1) {
      clearInterval(this.timerId);
      this.timerId = -1;
    }
  }

  // æ ¼å¼åŒ–æ—¶é—´ MM:SS
  formatTime(seconds: number): string {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    const formattedMinutes = String(minutes).padStart(2, '0');
    const formattedSeconds = String(remainingSeconds).padStart(2, '0');
    return `${formattedMinutes}:${formattedSeconds}`;
  }

  // æš‚åœ/ç»§ç»­
  togglePause() {
    this.isPaused = !this.isPaused;
  }

  // æ”¾å¼ƒ
  abandonFocus() {
    this.stopTimer();
    router.back();
  }

  build() {
    Column() {
      // å€’è®¡æ—¶
      Text(this.formatTime(this.timerValue))
        .fontSize(80)
        .fontWeight(FontWeight.Bold)
        .fontColor(Color.White)
        .margin({ top: '30%' })

      // å½“å‰ä»»åŠ¡
      Text(`å½“å‰ä»»åŠ¡: ${this.currentTask}`)
        .fontSize(16)
        .fontColor(Color.Gray)
        .margin({ top: 20, bottom: '35%' })

      // åº•éƒ¨çŽ¯å¢ƒéŸ³æ•ˆï¼ˆæš‚ä¸å®žçŽ°ï¼‰
      Row() {
        // ç¤ºä¾‹å›¾æ ‡
        Text('ðŸŒ§ï¸ é›¨å£°')
          .fontColor(Color.White).fontSize(14).margin({right:15})
        Text('ðŸ’¨ é£Žå£°')
          .fontColor(Color.White).fontSize(14).margin({right:15})
        Text('â˜•ï¸ å’–å•¡é¦†')
          .fontColor(Color.White).fontSize(14)
      }
      .margin({ bottom: 40 })

      // æŽ§åˆ¶æŒ‰é’®
      Row() {
        Button('æ”¾å¼ƒ', { type: ButtonType.Capsule, stateEffect: true })
          .width('45%')
          .height(50)
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .backgroundColor('#252525')
          .onClick(() => this.abandonFocus())

        Button(this.isPaused ? 'ç»§ç»­' : 'æš‚åœ', { type: ButtonType.Capsule, stateEffect: true })
          .width('45%')
          .height(50)
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .backgroundColor('#007DFF')
          .onClick(() => this.togglePause())
      }
      .width('90%')
      .justifyContent(FlexAlign.SpaceBetween)

    }
    .width('100%')
    .height('100%')
    .backgroundColor('#1C1C1C')
    .alignItems(HorizontalAlign.Center)
  }
}