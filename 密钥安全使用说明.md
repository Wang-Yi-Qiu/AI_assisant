# 密钥安全使用说明

## 📋 概述

本项目已实现安全的密钥管理机制，确保 API Key 不会泄露到代码仓库中。

## 🔒 安全特性

### 1. **图片保存功能**
- ✅ **已实现本地保存**：所有图片（PNG、JSON、HTML）都保存到用户手机本地
- ✅ **不依赖云端**：文件保存功能完全本地化，不涉及任何云端存储

### 2. **密钥管理安全策略**

#### ✅ 已实现的安全措施：

1. **密钥不存储在代码中**
   - API Key 不会出现在任何源代码文件中
   - 不会提交到 Git 仓库
   - 不会硬编码在配置文件中

2. **本地加密存储**
   - 使用 HarmonyOS `dataPreferences` 进行本地存储
   - API Key 使用 Base64 编码存储（防止明文泄露）
   - 密钥仅在内存中缓存，应用关闭后自动清除

3. **用户首次输入**
   - 用户首次使用时需要输入 API Key
   - 输入后自动加密保存，后续无需重复输入

## 📱 使用方法

### 步骤 1：获取 API Key

1. 访问 [阿里云 DashScope 控制台](https://dashscope.console.aliyun.com/)
2. 创建 API Key
3. 复制 API Key（格式类似：`sk-xxxxxxxxxxxxx`）

### 步骤 2：在应用中输入 API Key

1. 首次打开应用时，会提示输入 API Key
2. 在输入框中粘贴你的 API Key
3. 点击"保存"按钮
4. API Key 会被加密保存到手机本地

### 步骤 3：验证保存成功

- 应用会自动验证 API Key 是否有效
- 如果验证失败，会提示重新输入

## 🔐 安全建议

### ✅ 推荐做法：

1. **定期更换 API Key**
   - 建议每 3-6 个月更换一次 API Key
   - 在应用设置中可以删除旧 Key 并重新输入

2. **不要分享 API Key**
   - 不要将 API Key 发送给他人
   - 不要截图分享包含 API Key 的界面

3. **使用环境变量（开发环境）**
   - 开发时可以使用环境变量，但不要提交到代码仓库
   - 生产环境必须使用用户输入方式

### ⚠️ 注意事项：

1. **Base64 编码不是加密**
   - 当前实现使用 Base64 编码，这只能防止明文泄露
   - 对于更高安全要求，可以考虑使用 AES 加密（需要额外实现）

2. **设备安全**
   - 确保手机已设置锁屏密码
   - 不要将手机借给他人使用
   - 定期备份重要数据

3. **应用卸载**
   - 卸载应用时，存储的 API Key 会被自动删除
   - 重新安装后需要重新输入

## 🛠️ 技术实现

### 密钥存储位置

- **存储方式**：HarmonyOS `dataPreferences`
- **存储路径**：应用私有数据目录（其他应用无法访问）
- **编码方式**：Base64 编码
- **缓存位置**：应用内存（应用关闭后自动清除）

### 代码位置

- **密钥管理工具**：`entry/src/main/ets/utils/secureKeyManager.ets`
- **使用示例**：在需要 API Key 的地方调用 `secureKeyManager.getApiKey()`

## 📝 代码示例

```typescript
import { secureKeyManager } from '../utils/secureKeyManager';

// 检查是否已设置 API Key
const hasKey = await secureKeyManager.hasApiKey();

// 获取 API Key
const apiKey = await secureKeyManager.getApiKey();
if (!apiKey) {
  // 提示用户输入 API Key
  // ...
}

// 设置 API Key（用户输入后）
await secureKeyManager.setApiKey(userInputKey);

// 删除 API Key
await secureKeyManager.deleteApiKey();
```

## 🚨 常见问题

### Q: API Key 会泄露吗？
A: 不会。API Key 只存储在用户手机本地，不会上传到任何服务器，也不会出现在代码中。

### Q: 如果手机丢失怎么办？
A: 可以登录阿里云控制台，删除或禁用该 API Key，然后创建新的 Key。

### Q: 可以多台设备使用同一个 API Key 吗？
A: 可以，但建议为每台设备创建独立的 API Key，便于管理和监控。

### Q: 如何查看 API Key 使用情况？
A: 登录阿里云 DashScope 控制台，可以查看 API 调用统计和费用。

## 📞 技术支持

如有问题，请查看：
- 项目 README.md
- 阿里云 DashScope 文档
- 项目 Issues

---

**最后更新**：2024年





